{"version":3,"sources":["random.ts","element/newElement.ts","math.ts","element/bounds.ts","element/handlerRectangles.ts","element/collision.ts","element/resizeTest.ts","element/typeChecks.ts","keys.ts","element/textWysiwyg.tsx","utils.ts","element/textElement.ts","scene/scrollbars.ts","scene/selection.ts","renderer/roundRect.ts","renderer/renderElement.ts","renderer/renderScene.ts","scene/data.ts","scene/comparisons.ts","scene/createScene.ts","shapes.tsx","history.ts","components/Popover.tsx","components/ContextMenu.tsx","actions/manager.tsx","actions/actionDeleteSelected.tsx","zindex.ts","actions/actionZindex.tsx","actions/actionSelectAll.ts","components/ButtonSelect.tsx","components/ColorPicker.tsx","components/panels/PanelColor.tsx","actions/actionProperties.tsx","actions/actionCanvas.tsx","components/EditableText.tsx","actions/actionExport.tsx","actions/actionStyles.ts","components/Panel.tsx","components/panels/PanelTools.tsx","components/panels/PanelSelection.tsx","components/panels/PanelCanvas.tsx","components/panels/PanelExport.tsx","components/SidePanel.tsx","index.tsx"],"names":["randomSeed","Math","floor","random","withCustomMathRandom","seed","cb","imul","LCG","result","newElement","type","x","y","strokeColor","backgroundColor","fillStyle","strokeWidth","roughness","opacity","width","height","element","id","nanoid","isSelected","duplicateElement","copy","distanceBetweenPointAndSegment","x1","y1","x2","y2","xx","yy","C","D","lenSquare","param","dx","dy","hypot","rotate","angle","cos","sin","getElementAbsoluteCoords","getDiamondPoints","topX","rightX","rightY","getArrowPoints","distance","minSize","min","xs","ys","PI","x3","y3","handlerRectangles","scrollX","scrollY","elementX1","elementX2","elementY1","elementY2","handlers","marginX","marginY","abs","nw","se","hitTest","px","py","tx","ty","a","b","forEach","ex","ey","rx","ry","qx","qy","r","q","max","t","topY","bottomX","bottomY","leftX","leftY","x4","y4","console","warn","Error","resizeTest","filter","Object","keys","key","handler","length","getElementWithResizeHandler","elements","reduce","resizeHandle","isTextElement","KEYS","META_KEY","test","window","navigator","platform","textWysiwyg","initText","font","onSubmit","editable","document","createElement","stopEvent","ev","stopPropagation","handleSubmit","innerText","cleanup","onblur","onkeydown","onpaste","removeEventListener","body","removeChild","contentEditable","tabIndex","dataset","assign","style","color","position","top","left","transform","textAlign","display","padding","outline","whiteSpace","minHeight","preventDefault","text","clipboardData","getData","replace","textContent","addEventListener","appendChild","focus","selection","getSelection","range","createRange","selectNodeContents","removeAllRanges","addRange","capitalizeString","str","charAt","toUpperCase","slice","isInputLike","target","HTMLElement","HTMLInputElement","HTMLTextAreaElement","HTMLSelectElement","measureText","line","innerHTML","offsetWidth","offsetHeight","span","overflow","baseline","offsetTop","redrawTextBoundingBox","metrics","getScrollBars","canvasWidth","canvasHeight","minX","Infinity","maxX","minY","maxY","leftOverflow","rightOverflow","topOverflow","bottomOverflow","horizontalScrollBar","SCROLLBAR_MARGIN","verticalScrollBar","SCROLLBAR_WIDTH","horizontal","vertical","clearSelection","newElements","deleteSelectedElements","el","getSelectedIndices","selectedIndices","index","push","someElementIsSelected","some","getSelectedAttribute","getAttribute","attributes","Array","from","Set","map","roundRect","context","radius","beginPath","moveTo","lineTo","quadraticCurveTo","closePath","fill","stroke","generator","rough","renderElement","rc","fillRect","shape","rectangle","globalAlpha","translate","draw","polygon","ellipse","options","shapes","fillText","actualBoundingBoxAscent","renderScene","canvas","sceneState","offsetX","offsetY","renderScrollbars","renderSelection","getContext","viewBackgroundColor","clearRect","selectedElements","lineDash","getLineDash","setLineDash","strokeRect","margin","values","scrollBars","devicePixelRatio","strokeStyle","scrollBar","saveFile","name","data","link","setAttribute","click","remove","restore","savedElements","savedState","undefined","appState","getElementAtPosition","hitElement","i","SHAPES","icon","viewBox","d","value","shapesShortcutKeys","SceneHistory","recording","stateHistory","redoStack","JSON","stringify","newEntry","this","entry","skipRecording","parse","splice","currentEntry","generateCurrentEntry","entryToRestore","pop","restoreEntry","Popover","children","onCloseRequest","className","onClick","onContextMenu","e","contextMenuNode","ContextMenu","option","idx","ContextMenuOption","label","action","getContextMenuNode","div","handleClose","unmountComponentAtNode","params","of","render","ActionManager","actions","updater","event","sort","keyPriority","keyTest","perform","log","contextItemLabel","contextMenuOrder","PanelComponent","updateData","formState","actionDeleteSelected","swap","indexA","indexB","moveOneLeft","indicesToMove","isSorted","moveOneRight","reversedIndicesToMove","moveAllLeft","leftMostElements","reverse","concat","pos","moveAllRight","rightMostElements","actionSendBackward","shiftKey","altKey","code","actionBringForward","actionSendToBack","actionBringToFront","actionSelectAll","elem","ButtonSelect","onChange","TwitterPicker","lazy","ColorPicker","React","useState","isActive","setActive","Suspense","fallback","colors","changedColor","hex","onPaste","PanelColor","title","onColorChange","colorValue","changeProperty","callback","actionChangeStrokeColor","currentItemStrokeColor","actionChangeBackgroundColor","currentItemBackgroundColor","actionChangeFillStyle","actionChangeStrokeWidth","actionChangeSloppiness","actionChangeOpacity","actionChangeFontSize","split","actionChangeFontFamily","actionChangeViewBackgroundColor","actionClearCanvas","confirm","EditableText","props","state","edit","setState","maxLength","handleEdit","onBlur","handleBlur","onKeyDown","autoFocus","Component","actionChangeProjectName","actionChangeExportBackground","exportBackground","checked","actionSaveScene","serialized","version","source","location","origin","encodeURIComponent","saveAsJSON","actionLoadScene","loadedElements","input","reader","FileReader","accept","onchange","files","readAsText","alert","Promise","resolve","onloadend","readyState","DONE","loadFromJSON","then","copiedStyles","actionCopyStyles","find","actionPasteStyles","pastedElement","Panel","defaultCollapsed","hide","collapsed","setCollapsed","PanelTools","activeTool","onToolChange","PanelSelection","actionManager","syncActionResult","renderAction","PanelCanvas","ClipboardIcon","probablySupportsClipboard","HTMLCanvasElement","prototype","clipboard","PanelExport","onExportCanvas","SidePanel","elementType","hasBackground","hasStroke","hasText","exportPadding","subCanvasX1","subCanvasX2","subCanvasY1","subCanvasY2","tempCanvas","toDataURL","toBlob","blob","async","write","ClipboardItem","err","exportCanvas","history","DEFAULT_PROJECT_NAME","date","Date","year","getFullYear","month","getMonth","day","getDate","hr","getHours","getMinutes","secs","getSeconds","getDateTime","resetCursor","documentElement","cursor","addTextElement","lastCanvasWidth","lastCanvasHeight","lastMouseUp","viewportCoordsToSceneCoords","clientX","clientY","App","res","forceUpdate","draggingElement","resizingElement","currentItemFont","cursorX","cursorY","onResize","getCurrentCursorPosition","activeElement","blur","keyCode","handleKeyDown","step","includes","toLowerCase","redoOnce","undoOnce","removeWheelEventListener","copyToClipboard","writeText","pasteFromClipboard","readText","addElementsFromPaste","handleWheel","deltaX","deltaY","paste","parsedElements","isArray","parsedElement","elementsCenterX","elementsCenterY","duplicate","registerAction","localStorage","getItem","restoreFromLocalStorage","innerWidth","innerHeight","onCut","setData","onCopy","ref","passive","scale","getContextMenuItems","onMouseDown","button","isOverHorizontalScrollBar","isOverVerticalScrollBar","isOverScrollBars","isResizingElements","draggingOccured","elementIsAddedToSelection","resizeElement","duplicates","textX","textY","snappedToCenterPosition","getTextWysiwygSnappedToCenterPosition","elementCenterX","elementCenterY","wysiwygX","wysiwygY","lastX","lastY","onMouseMove","sign","selectionX1","selectionY1","selectionX2","selectionY2","setSelection","onMouseUp","resumeRecording","onDoubleClick","elementAtPosition","Boolean","buttons","elementClickedInside","getElementContainingPosition","setItem","isRecording","pushEntry","clearRedoStack","rootElement","getElementById","ReactDOM"],"mappings":"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","file":"static/js/main.b4b90dbd.chunk.js","sourcesContent":["// https://stackoverflow.com/questions/521295/seeding-the-random-number-generator-in-javascript/47593316#47593316\nexport const LCG = (seed: number) => () =>\n  ((2 ** 31 - 1) & (seed = Math.imul(48271, seed))) / 2 ** 31;\n\nexport function randomSeed() {\n  return Math.floor(Math.random() * 2 ** 31);\n}\n\n// Unfortunately, roughjs doesn't support a seed attribute (https://github.com/pshihn/rough/issues/27).\n// We can achieve the same result by overriding the Math.random function with a\n// pseudo random generator that supports a random seed and swapping it back after.\nexport function withCustomMathRandom<T>(seed: number, cb: () => T): T {\n  const random = Math.random;\n  Math.random = LCG(seed);\n  const result = cb();\n  Math.random = random;\n  return result;\n}\n","import { randomSeed } from \"../random\";\nimport nanoid from \"nanoid\";\n\nexport function newElement(\n  type: string,\n  x: number,\n  y: number,\n  strokeColor: string,\n  backgroundColor: string,\n  fillStyle: string,\n  strokeWidth: number,\n  roughness: number,\n  opacity: number,\n  width = 0,\n  height = 0\n) {\n  const element = {\n    id: nanoid(),\n    type,\n    x,\n    y,\n    width,\n    height,\n    strokeColor,\n    backgroundColor,\n    fillStyle,\n    strokeWidth,\n    roughness,\n    opacity,\n    isSelected: false,\n    seed: randomSeed()\n  };\n  return element;\n}\n\nexport function duplicateElement(element: ReturnType<typeof newElement>) {\n  const copy = { ...element };\n  copy.id = nanoid();\n  copy.seed = randomSeed();\n  return copy;\n}\n","// https://stackoverflow.com/a/6853926/232122\nexport function distanceBetweenPointAndSegment(\n  x: number,\n  y: number,\n  x1: number,\n  y1: number,\n  x2: number,\n  y2: number\n) {\n  const A = x - x1;\n  const B = y - y1;\n  const C = x2 - x1;\n  const D = y2 - y1;\n\n  const dot = A * C + B * D;\n  const lenSquare = C * C + D * D;\n  let param = -1;\n  if (lenSquare !== 0) {\n    // in case of 0 length line\n    param = dot / lenSquare;\n  }\n\n  let xx, yy;\n  if (param < 0) {\n    xx = x1;\n    yy = y1;\n  } else if (param > 1) {\n    xx = x2;\n    yy = y2;\n  } else {\n    xx = x1 + param * C;\n    yy = y1 + param * D;\n  }\n\n  const dx = x - xx;\n  const dy = y - yy;\n  return Math.hypot(dx, dy);\n}\n\nexport function rotate(\n  x1: number,\n  y1: number,\n  x2: number,\n  y2: number,\n  angle: number\n) {\n  // =()cos()sin+\n  // =()sin+()cos+.\n  // https://math.stackexchange.com/questions/2204520/how-do-i-rotate-a-line-segment-in-a-specific-point-on-the-line\n  return [\n    (x1 - x2) * Math.cos(angle) - (y1 - y2) * Math.sin(angle) + x2,\n    (x1 - x2) * Math.sin(angle) + (y1 - y2) * Math.cos(angle) + y2\n  ];\n}\n","import { ExcalidrawElement } from \"./types\";\nimport { rotate } from \"../math\";\n\n// If the element is created from right to left, the width is going to be negative\n// This set of functions retrieves the absolute position of the 4 points.\n// We can't just always normalize it since we need to remember the fact that an arrow\n// is pointing left or right.\nexport function getElementAbsoluteCoords(element: ExcalidrawElement) {\n  return [\n    element.width >= 0 ? element.x : element.x + element.width, // x1\n    element.height >= 0 ? element.y : element.y + element.height, // y1\n    element.width >= 0 ? element.x + element.width : element.x, // x2\n    element.height >= 0 ? element.y + element.height : element.y // y2\n  ];\n}\n\nexport function getDiamondPoints(element: ExcalidrawElement) {\n  // Here we add +1 to avoid these numbers to be 0\n  // otherwise rough.js will throw an error complaining about it\n  const topX = Math.floor(element.width / 2) + 1;\n  const topY = 0;\n  const rightX = element.width;\n  const rightY = Math.floor(element.height / 2) + 1;\n  const bottomX = topX;\n  const bottomY = element.height;\n  const leftX = topY;\n  const leftY = rightY;\n\n  return [topX, topY, rightX, rightY, bottomX, bottomY, leftX, leftY];\n}\n\nexport function getArrowPoints(element: ExcalidrawElement) {\n  const x1 = 0;\n  const y1 = 0;\n  const x2 = element.width;\n  const y2 = element.height;\n\n  const size = 30; // pixels\n  const distance = Math.hypot(x2 - x1, y2 - y1);\n  // Scale down the arrow until we hit a certain size so that it doesn't look weird\n  const minSize = Math.min(size, distance / 2);\n  const xs = x2 - ((x2 - x1) / distance) * minSize;\n  const ys = y2 - ((y2 - y1) / distance) * minSize;\n\n  const angle = 20; // degrees\n  const [x3, y3] = rotate(xs, ys, x2, y2, (-angle * Math.PI) / 180);\n  const [x4, y4] = rotate(xs, ys, x2, y2, (angle * Math.PI) / 180);\n\n  return [x1, y1, x2, y2, x3, y3, x4, y4];\n}\n","import { ExcalidrawElement } from \"./types\";\nimport { SceneScroll } from \"../scene/types\";\n\ntype Sides = \"n\" | \"s\" | \"w\" | \"e\" | \"nw\" | \"ne\" | \"sw\" | \"se\";\n\nexport function handlerRectangles(\n  element: ExcalidrawElement,\n  { scrollX, scrollY }: SceneScroll\n) {\n  const elementX1 = element.x;\n  const elementX2 = element.x + element.width;\n  const elementY1 = element.y;\n  const elementY2 = element.y + element.height;\n\n  const margin = 4;\n  const minimumSize = 40;\n  const handlers = {} as { [T in Sides]: number[] };\n\n  const marginX = element.width < 0 ? 8 : -8;\n  const marginY = element.height < 0 ? 8 : -8;\n\n  if (Math.abs(elementX2 - elementX1) > minimumSize) {\n    handlers[\"n\"] = [\n      elementX1 + (elementX2 - elementX1) / 2 + scrollX - 4,\n      elementY1 - margin + scrollY + marginY,\n      8,\n      8\n    ];\n\n    handlers[\"s\"] = [\n      elementX1 + (elementX2 - elementX1) / 2 + scrollX - 4,\n      elementY2 - margin + scrollY - marginY,\n      8,\n      8\n    ];\n  }\n\n  if (Math.abs(elementY2 - elementY1) > minimumSize) {\n    handlers[\"w\"] = [\n      elementX1 - margin + scrollX + marginX,\n      elementY1 + (elementY2 - elementY1) / 2 + scrollY - 4,\n      8,\n      8\n    ];\n\n    handlers[\"e\"] = [\n      elementX2 - margin + scrollX - marginX,\n      elementY1 + (elementY2 - elementY1) / 2 + scrollY - 4,\n      8,\n      8\n    ];\n  }\n\n  handlers[\"nw\"] = [\n    elementX1 - margin + scrollX + marginX,\n    elementY1 - margin + scrollY + marginY,\n    8,\n    8\n  ]; // nw\n  handlers[\"ne\"] = [\n    elementX2 - margin + scrollX - marginX,\n    elementY1 - margin + scrollY + marginY,\n    8,\n    8\n  ]; // ne\n  handlers[\"sw\"] = [\n    elementX1 - margin + scrollX + marginX,\n    elementY2 - margin + scrollY - marginY,\n    8,\n    8\n  ]; // sw\n  handlers[\"se\"] = [\n    elementX2 - margin + scrollX - marginX,\n    elementY2 - margin + scrollY - marginY,\n    8,\n    8\n  ]; // se\n\n  if (element.type === \"arrow\") {\n    return {\n      nw: handlers.nw,\n      se: handlers.se\n    } as typeof handlers;\n  }\n\n  return handlers;\n}\n","import { distanceBetweenPointAndSegment } from \"../math\";\n\nimport { ExcalidrawElement } from \"./types\";\nimport {\n  getArrowPoints,\n  getDiamondPoints,\n  getElementAbsoluteCoords\n} from \"./bounds\";\n\nexport function hitTest(\n  element: ExcalidrawElement,\n  x: number,\n  y: number\n): boolean {\n  // For shapes that are composed of lines, we only enable point-selection when the distance\n  // of the click is less than x pixels of any of the lines that the shape is composed of\n  const lineThreshold = 10;\n\n  if (element.type === \"ellipse\") {\n    // https://stackoverflow.com/a/46007540/232122\n    const px = Math.abs(x - element.x - element.width / 2);\n    const py = Math.abs(y - element.y - element.height / 2);\n\n    let tx = 0.707;\n    let ty = 0.707;\n\n    const a = Math.abs(element.width) / 2;\n    const b = Math.abs(element.height) / 2;\n\n    [0, 1, 2, 3].forEach(x => {\n      const xx = a * tx;\n      const yy = b * ty;\n\n      const ex = ((a * a - b * b) * tx ** 3) / a;\n      const ey = ((b * b - a * a) * ty ** 3) / b;\n\n      const rx = xx - ex;\n      const ry = yy - ey;\n\n      const qx = px - ex;\n      const qy = py - ey;\n\n      const r = Math.hypot(ry, rx);\n      const q = Math.hypot(qy, qx);\n\n      tx = Math.min(1, Math.max(0, ((qx * r) / q + ex) / a));\n      ty = Math.min(1, Math.max(0, ((qy * r) / q + ey) / b));\n      const t = Math.hypot(ty, tx);\n      tx /= t;\n      ty /= t;\n    });\n\n    return Math.hypot(a * tx - px, b * ty - py) < lineThreshold;\n  } else if (element.type === \"rectangle\") {\n    const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\n\n    // (x1, y1) --A-- (x2, y1)\n    //    |D             |B\n    // (x1, y2) --C-- (x2, y2)\n    return (\n      distanceBetweenPointAndSegment(x, y, x1, y1, x2, y1) < lineThreshold || // A\n      distanceBetweenPointAndSegment(x, y, x2, y1, x2, y2) < lineThreshold || // B\n      distanceBetweenPointAndSegment(x, y, x2, y2, x1, y2) < lineThreshold || // C\n      distanceBetweenPointAndSegment(x, y, x1, y2, x1, y1) < lineThreshold // D\n    );\n  } else if (element.type === \"diamond\") {\n    x -= element.x;\n    y -= element.y;\n\n    const [\n      topX,\n      topY,\n      rightX,\n      rightY,\n      bottomX,\n      bottomY,\n      leftX,\n      leftY\n    ] = getDiamondPoints(element);\n\n    return (\n      distanceBetweenPointAndSegment(x, y, topX, topY, rightX, rightY) <\n        lineThreshold ||\n      distanceBetweenPointAndSegment(x, y, rightX, rightY, bottomX, bottomY) <\n        lineThreshold ||\n      distanceBetweenPointAndSegment(x, y, bottomX, bottomY, leftX, leftY) <\n        lineThreshold ||\n      distanceBetweenPointAndSegment(x, y, leftX, leftY, topX, topY) <\n        lineThreshold\n    );\n  } else if (element.type === \"arrow\") {\n    let [x1, y1, x2, y2, x3, y3, x4, y4] = getArrowPoints(element);\n    // The computation is done at the origin, we need to add a translation\n    x -= element.x;\n    y -= element.y;\n\n    return (\n      //    \\\n      distanceBetweenPointAndSegment(x, y, x3, y3, x2, y2) < lineThreshold ||\n      // -----\n      distanceBetweenPointAndSegment(x, y, x1, y1, x2, y2) < lineThreshold ||\n      //    /\n      distanceBetweenPointAndSegment(x, y, x4, y4, x2, y2) < lineThreshold\n    );\n  } else if (element.type === \"text\") {\n    const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\n\n    return x >= x1 && x <= x2 && y >= y1 && y <= y2;\n  } else if (element.type === \"selection\") {\n    console.warn(\"This should not happen, we need to investigate why it does.\");\n    return false;\n  } else {\n    throw new Error(\"Unimplemented type \" + element.type);\n  }\n}\n","import { ExcalidrawElement } from \"./types\";\n\nimport { handlerRectangles } from \"./handlerRectangles\";\nimport { SceneScroll } from \"../scene/types\";\n\ntype HandlerRectanglesRet = keyof ReturnType<typeof handlerRectangles>;\n\nexport function resizeTest(\n  element: ExcalidrawElement,\n  x: number,\n  y: number,\n  { scrollX, scrollY }: SceneScroll\n): HandlerRectanglesRet | false {\n  if (!element.isSelected || element.type === \"text\") return false;\n\n  const handlers = handlerRectangles(element, { scrollX, scrollY });\n\n  const filter = Object.keys(handlers).filter(key => {\n    const handler = handlers[key as HandlerRectanglesRet]!;\n\n    return (\n      x + scrollX >= handler[0] &&\n      x + scrollX <= handler[0] + handler[2] &&\n      y + scrollY >= handler[1] &&\n      y + scrollY <= handler[1] + handler[3]\n    );\n  });\n\n  if (filter.length > 0) {\n    return filter[0] as HandlerRectanglesRet;\n  }\n\n  return false;\n}\n\nexport function getElementWithResizeHandler(\n  elements: readonly ExcalidrawElement[],\n  { x, y }: { x: number; y: number },\n  { scrollX, scrollY }: SceneScroll\n) {\n  return elements.reduce((result, element) => {\n    if (result) {\n      return result;\n    }\n    const resizeHandle = resizeTest(element, x, y, {\n      scrollX,\n      scrollY\n    });\n    return resizeHandle ? { element, resizeHandle } : null;\n  }, null as { element: ExcalidrawElement; resizeHandle: ReturnType<typeof resizeTest> } | null);\n}\n","import { ExcalidrawElement, ExcalidrawTextElement } from \"./types\";\n\nexport function isTextElement(\n  element: ExcalidrawElement\n): element is ExcalidrawTextElement {\n  return element.type === \"text\";\n}\n","export const KEYS = {\n  ARROW_LEFT: \"ArrowLeft\",\n  ARROW_RIGHT: \"ArrowRight\",\n  ARROW_DOWN: \"ArrowDown\",\n  ARROW_UP: \"ArrowUp\",\n  ENTER: \"Enter\",\n  ESCAPE: \"Escape\",\n  DELETE: \"Delete\",\n  BACKSPACE: \"Backspace\"\n};\n\nexport const META_KEY = /Mac|iPod|iPhone|iPad/.test(window.navigator.platform)\n  ? \"metaKey\"\n  : \"ctrlKey\";\n\nexport function isArrowKey(keyCode: string) {\n  return (\n    keyCode === KEYS.ARROW_LEFT ||\n    keyCode === KEYS.ARROW_RIGHT ||\n    keyCode === KEYS.ARROW_DOWN ||\n    keyCode === KEYS.ARROW_UP\n  );\n}\n","import { KEYS } from \"../keys\";\n\ntype TextWysiwygParams = {\n  initText: string;\n  x: number;\n  y: number;\n  strokeColor: string;\n  font: string;\n  onSubmit: (text: string) => void;\n};\n\nexport function textWysiwyg({\n  initText,\n  x,\n  y,\n  strokeColor,\n  font,\n  onSubmit\n}: TextWysiwygParams) {\n  // Using contenteditable here as it has dynamic width.\n  // But this solution has an issue  it allows to paste\n  // multiline text, which is not currently supported\n  const editable = document.createElement(\"div\");\n  editable.contentEditable = \"true\";\n  editable.tabIndex = 0;\n  editable.innerText = initText;\n  editable.dataset.type = \"wysiwyg\";\n\n  Object.assign(editable.style, {\n    color: strokeColor,\n    position: \"absolute\",\n    top: y + \"px\",\n    left: x + \"px\",\n    transform: \"translate(-50%, -50%)\",\n    textAlign: \"center\",\n    display: \"inline-block\",\n    font: font,\n    padding: \"4px\",\n    outline: \"transparent\",\n    whiteSpace: \"nowrap\",\n    minHeight: \"1em\"\n  });\n\n  editable.onkeydown = ev => {\n    if (ev.key === KEYS.ESCAPE) {\n      ev.preventDefault();\n      if (initText) {\n        editable.innerText = initText;\n        handleSubmit();\n        return;\n      }\n      cleanup();\n      return;\n    }\n    if (ev.key === KEYS.ENTER) {\n      ev.preventDefault();\n      handleSubmit();\n    }\n  };\n  editable.onblur = handleSubmit;\n  // override paste to disallow non-textual data, and replace newlines\n  editable.onpaste = ev => {\n    ev.preventDefault();\n    try {\n      const text = ev.clipboardData!.getData(\"text\").replace(/\\n+/g, \" \");\n      editable.textContent = text;\n    } catch {}\n  };\n\n  function stopEvent(ev: Event) {\n    ev.stopPropagation();\n  }\n\n  function handleSubmit() {\n    if (editable.innerText) {\n      onSubmit(editable.innerText);\n    }\n    cleanup();\n  }\n\n  function cleanup() {\n    editable.onblur = null;\n    editable.onkeydown = null;\n    editable.onpaste = null;\n    window.removeEventListener(\"wheel\", stopEvent, true);\n    document.body.removeChild(editable);\n  }\n\n  window.addEventListener(\"wheel\", stopEvent, true);\n  document.body.appendChild(editable);\n  editable.focus();\n  const selection = window.getSelection();\n  if (selection) {\n    const range = document.createRange();\n    range.selectNodeContents(editable);\n    selection.removeAllRanges();\n    selection.addRange(range);\n  }\n}\n","export function getDateTime() {\n  const date = new Date();\n  const year = date.getFullYear();\n  const month = date.getMonth() + 1;\n  const day = date.getDate();\n  const hr = date.getHours();\n  const min = date.getMinutes();\n  const secs = date.getSeconds();\n\n  return `${year}${month}${day}${hr}${min}${secs}`;\n}\n\nexport function capitalizeString(str: string) {\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\nexport function isInputLike(\n  target: Element | EventTarget | null\n): target is HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement {\n  return (\n    (target instanceof HTMLElement && target.dataset.type === \"wysiwyg\") ||\n    target instanceof HTMLInputElement ||\n    target instanceof HTMLTextAreaElement ||\n    target instanceof HTMLSelectElement\n  );\n}\n\n// https://github.com/grassator/canvas-text-editor/blob/master/lib/FontMetrics.js\nexport function measureText(text: string, font: string) {\n  const line = document.createElement(\"div\");\n  const body = document.body;\n  line.style.position = \"absolute\";\n  line.style.whiteSpace = \"nowrap\";\n  line.style.font = font;\n  body.appendChild(line);\n  // Now we can measure width and height of the letter\n  line.innerHTML = text;\n  const width = line.offsetWidth;\n  const height = line.offsetHeight;\n  // Now creating 1px sized item that will be aligned to baseline\n  // to calculate baseline shift\n  const span = document.createElement(\"span\");\n  span.style.display = \"inline-block\";\n  span.style.overflow = \"hidden\";\n  span.style.width = \"1px\";\n  span.style.height = \"1px\";\n  line.appendChild(span);\n  // Baseline is important for positioning text on canvas\n  const baseline = span.offsetTop + span.offsetHeight;\n  document.body.removeChild(line);\n\n  return { width, height, baseline };\n}\n","import { measureText } from \"../utils\";\nimport { ExcalidrawTextElement } from \"./types\";\n\nexport const redrawTextBoundingBox = (element: ExcalidrawTextElement) => {\n  const metrics = measureText(element.text, element.font);\n  element.width = metrics.width;\n  element.height = metrics.height;\n  element.baseline = metrics.baseline;\n};\n","import { ExcalidrawElement } from \"../element/types\";\nimport { getElementAbsoluteCoords } from \"../element\";\n\nconst SCROLLBAR_MIN_SIZE = 15;\nconst SCROLLBAR_MARGIN = 4;\nexport const SCROLLBAR_WIDTH = 6;\nexport const SCROLLBAR_COLOR = \"rgba(0,0,0,0.3)\";\n\nexport function getScrollBars(\n  elements: readonly ExcalidrawElement[],\n  canvasWidth: number,\n  canvasHeight: number,\n  scrollX: number,\n  scrollY: number\n) {\n  let minX = Infinity;\n  let maxX = 0;\n  let minY = Infinity;\n  let maxY = 0;\n\n  elements.forEach(element => {\n    const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\n    minX = Math.min(minX, x1);\n    minY = Math.min(minY, y1);\n    maxX = Math.max(maxX, x2);\n    maxY = Math.max(maxY, y2);\n  });\n\n  minX += scrollX;\n  maxX += scrollX;\n  minY += scrollY;\n  maxY += scrollY;\n  const leftOverflow = Math.max(-minX, 0);\n  const rightOverflow = Math.max(-(canvasWidth - maxX), 0);\n  const topOverflow = Math.max(-minY, 0);\n  const bottomOverflow = Math.max(-(canvasHeight - maxY), 0);\n\n  // horizontal scrollbar\n  let horizontalScrollBar = null;\n  if (leftOverflow || rightOverflow) {\n    horizontalScrollBar = {\n      x: Math.min(\n        leftOverflow + SCROLLBAR_MARGIN,\n        canvasWidth - SCROLLBAR_MIN_SIZE - SCROLLBAR_MARGIN\n      ),\n      y: canvasHeight - SCROLLBAR_WIDTH - SCROLLBAR_MARGIN,\n      width: Math.max(\n        canvasWidth - rightOverflow - leftOverflow - SCROLLBAR_MARGIN * 2,\n        SCROLLBAR_MIN_SIZE\n      ),\n      height: SCROLLBAR_WIDTH\n    };\n  }\n\n  // vertical scrollbar\n  let verticalScrollBar = null;\n  if (topOverflow || bottomOverflow) {\n    verticalScrollBar = {\n      x: canvasWidth - SCROLLBAR_WIDTH - SCROLLBAR_MARGIN,\n      y: Math.min(\n        topOverflow + SCROLLBAR_MARGIN,\n        canvasHeight - SCROLLBAR_MIN_SIZE - SCROLLBAR_MARGIN\n      ),\n      width: SCROLLBAR_WIDTH,\n      height: Math.max(\n        canvasHeight - bottomOverflow - topOverflow - SCROLLBAR_WIDTH * 2,\n        SCROLLBAR_MIN_SIZE\n      )\n    };\n  }\n\n  return {\n    horizontal: horizontalScrollBar,\n    vertical: verticalScrollBar\n  };\n}\n\nexport function isOverScrollBars(\n  elements: readonly ExcalidrawElement[],\n  x: number,\n  y: number,\n  canvasWidth: number,\n  canvasHeight: number,\n  scrollX: number,\n  scrollY: number\n) {\n  const scrollBars = getScrollBars(\n    elements,\n    canvasWidth,\n    canvasHeight,\n    scrollX,\n    scrollY\n  );\n\n  const [isOverHorizontalScrollBar, isOverVerticalScrollBar] = [\n    scrollBars.horizontal,\n    scrollBars.vertical\n  ].map(\n    scrollBar =>\n      scrollBar &&\n      scrollBar.x <= x &&\n      x <= scrollBar.x + scrollBar.width &&\n      scrollBar.y <= y &&\n      y <= scrollBar.y + scrollBar.height\n  );\n\n  return {\n    isOverHorizontalScrollBar,\n    isOverVerticalScrollBar\n  };\n}\n","import { ExcalidrawElement } from \"../element/types\";\nimport { getElementAbsoluteCoords } from \"../element\";\n\nexport function setSelection(\n  elements: readonly ExcalidrawElement[],\n  selection: ExcalidrawElement\n) {\n  const [\n    selectionX1,\n    selectionY1,\n    selectionX2,\n    selectionY2\n  ] = getElementAbsoluteCoords(selection);\n  elements.forEach(element => {\n    const [\n      elementX1,\n      elementY1,\n      elementX2,\n      elementY2\n    ] = getElementAbsoluteCoords(element);\n    element.isSelected =\n      element.type !== \"selection\" &&\n      selectionX1 <= elementX1 &&\n      selectionY1 <= elementY1 &&\n      selectionX2 >= elementX2 &&\n      selectionY2 >= elementY2;\n  });\n\n  return elements;\n}\n\nexport function clearSelection(elements: readonly ExcalidrawElement[]) {\n  const newElements = [...elements];\n\n  newElements.forEach(element => {\n    element.isSelected = false;\n  });\n\n  return newElements;\n}\n\nexport function deleteSelectedElements(elements: readonly ExcalidrawElement[]) {\n  return elements.filter(el => !el.isSelected);\n}\n\nexport function getSelectedIndices(elements: readonly ExcalidrawElement[]) {\n  const selectedIndices: number[] = [];\n  elements.forEach((element, index) => {\n    if (element.isSelected) {\n      selectedIndices.push(index);\n    }\n  });\n  return selectedIndices;\n}\n\nexport const someElementIsSelected = (elements: readonly ExcalidrawElement[]) =>\n  elements.some(element => element.isSelected);\n\nexport function getSelectedAttribute<T>(\n  elements: readonly ExcalidrawElement[],\n  getAttribute: (element: ExcalidrawElement) => T\n): T | null {\n  const attributes = Array.from(\n    new Set(\n      elements\n        .filter(element => element.isSelected)\n        .map(element => getAttribute(element))\n    )\n  );\n  return attributes.length === 1 ? attributes[0] : null;\n}\n","/**\n * https://stackoverflow.com/a/3368118\n * Draws a rounded rectangle using the current state of the canvas.\n * @param {CanvasRenderingContext2D} context\n * @param {Number} x The top left x coordinate\n * @param {Number} y The top left y coordinate\n * @param {Number} width The width of the rectangle\n * @param {Number} height The height of the rectangle\n * @param {Number} radius The corner radius\n */\nexport function roundRect(\n  context: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  radius: number\n) {\n  context.beginPath();\n  context.moveTo(x + radius, y);\n  context.lineTo(x + width - radius, y);\n  context.quadraticCurveTo(x + width, y, x + width, y + radius);\n  context.lineTo(x + width, y + height - radius);\n  context.quadraticCurveTo(\n    x + width,\n    y + height,\n    x + width - radius,\n    y + height\n  );\n  context.lineTo(x + radius, y + height);\n  context.quadraticCurveTo(x, y + height, x, y + height - radius);\n  context.lineTo(x, y + radius);\n  context.quadraticCurveTo(x, y, x + radius, y);\n  context.closePath();\n  context.fill();\n  context.stroke();\n}\n","import rough from \"roughjs/bin/wrappers/rough\";\n\nimport { withCustomMathRandom } from \"../random\";\n\nimport { ExcalidrawElement } from \"../element/types\";\nimport { isTextElement } from \"../element/typeChecks\";\nimport { getDiamondPoints, getArrowPoints } from \"../element/bounds\";\nimport { RoughCanvas } from \"roughjs/bin/canvas\";\nimport { SceneState } from \"../scene/types\";\n\n// Casting second argument (DrawingSurface) to any,\n// because it is requred by TS definitions and not required at runtime\nconst generator = rough.generator(null, null as any);\n\nexport function renderElement(\n  element: ExcalidrawElement,\n  rc: RoughCanvas,\n  context: CanvasRenderingContext2D,\n  { scrollX, scrollY }: SceneState\n) {\n  if (element.type === \"selection\") {\n    const fillStyle = context.fillStyle;\n    context.fillStyle = \"rgba(0, 0, 255, 0.10)\";\n    context.fillRect(\n      element.x + scrollX,\n      element.y + scrollY,\n      element.width,\n      element.height\n    );\n    context.fillStyle = fillStyle;\n  } else if (element.type === \"rectangle\") {\n    const shape = withCustomMathRandom(element.seed, () => {\n      return generator.rectangle(0, 0, element.width, element.height, {\n        stroke: element.strokeColor,\n        fill: element.backgroundColor,\n        fillStyle: element.fillStyle,\n        strokeWidth: element.strokeWidth,\n        roughness: element.roughness\n      });\n    });\n\n    context.globalAlpha = element.opacity / 100;\n    context.translate(element.x + scrollX, element.y + scrollY);\n    rc.draw(shape);\n    context.translate(-element.x - scrollX, -element.y - scrollY);\n    context.globalAlpha = 1;\n  } else if (element.type === \"diamond\") {\n    const shape = withCustomMathRandom(element.seed, () => {\n      const [\n        topX,\n        topY,\n        rightX,\n        rightY,\n        bottomX,\n        bottomY,\n        leftX,\n        leftY\n      ] = getDiamondPoints(element);\n      return generator.polygon(\n        [\n          [topX, topY],\n          [rightX, rightY],\n          [bottomX, bottomY],\n          [leftX, leftY]\n        ],\n        {\n          stroke: element.strokeColor,\n          fill: element.backgroundColor,\n          fillStyle: element.fillStyle,\n          strokeWidth: element.strokeWidth,\n          roughness: element.roughness\n        }\n      );\n    });\n    context.globalAlpha = element.opacity / 100;\n    context.translate(element.x + scrollX, element.y + scrollY);\n    rc.draw(shape);\n    context.translate(-element.x - scrollX, -element.y - scrollY);\n    context.globalAlpha = 1;\n  } else if (element.type === \"ellipse\") {\n    const shape = withCustomMathRandom(element.seed, () =>\n      generator.ellipse(\n        element.width / 2,\n        element.height / 2,\n        element.width,\n        element.height,\n        {\n          stroke: element.strokeColor,\n          fill: element.backgroundColor,\n          fillStyle: element.fillStyle,\n          strokeWidth: element.strokeWidth,\n          roughness: element.roughness\n        }\n      )\n    );\n\n    context.globalAlpha = element.opacity / 100;\n    context.translate(element.x + scrollX, element.y + scrollY);\n    rc.draw(shape);\n    context.translate(-element.x - scrollX, -element.y - scrollY);\n    context.globalAlpha = 1;\n  } else if (element.type === \"arrow\") {\n    const [x1, y1, x2, y2, x3, y3, x4, y4] = getArrowPoints(element);\n    const options = {\n      stroke: element.strokeColor,\n      strokeWidth: element.strokeWidth,\n      roughness: element.roughness\n    };\n\n    const shapes = withCustomMathRandom(element.seed, () => [\n      //    \\\n      generator.line(x3, y3, x2, y2, options),\n      // -----\n      generator.line(x1, y1, x2, y2, options),\n      //    /\n      generator.line(x4, y4, x2, y2, options)\n    ]);\n\n    context.globalAlpha = element.opacity / 100;\n    context.translate(element.x + scrollX, element.y + scrollY);\n    shapes.forEach(shape => rc.draw(shape));\n    context.translate(-element.x - scrollX, -element.y - scrollY);\n    context.globalAlpha = 1;\n    return;\n  } else if (isTextElement(element)) {\n    context.globalAlpha = element.opacity / 100;\n    const font = context.font;\n    context.font = element.font;\n    const fillStyle = context.fillStyle;\n    context.fillStyle = element.strokeColor;\n    context.fillText(\n      element.text,\n      element.x + scrollX,\n      element.y +\n        scrollY +\n        (element.baseline || element.actualBoundingBoxAscent || 0)\n    );\n    context.fillStyle = fillStyle;\n    context.font = font;\n    context.globalAlpha = 1;\n  } else {\n    throw new Error(\"Unimplemented type \" + element.type);\n  }\n}\n","import { RoughCanvas } from \"roughjs/bin/canvas\";\n\nimport { ExcalidrawElement } from \"../element/types\";\nimport { getElementAbsoluteCoords, handlerRectangles } from \"../element\";\n\nimport { roundRect } from \"./roundRect\";\nimport { SceneState } from \"../scene/types\";\nimport {\n  getScrollBars,\n  SCROLLBAR_COLOR,\n  SCROLLBAR_WIDTH\n} from \"../scene/scrollbars\";\n\nimport { renderElement } from \"./renderElement\";\n\nexport function renderScene(\n  elements: readonly ExcalidrawElement[],\n  rc: RoughCanvas,\n  canvas: HTMLCanvasElement,\n  sceneState: SceneState,\n  // extra options, currently passed by export helper\n  {\n    offsetX,\n    offsetY,\n    renderScrollbars = true,\n    renderSelection = true\n  }: {\n    offsetX?: number;\n    offsetY?: number;\n    renderScrollbars?: boolean;\n    renderSelection?: boolean;\n  } = {}\n) {\n  if (!canvas) return;\n  const context = canvas.getContext(\"2d\")!;\n\n  const fillStyle = context.fillStyle;\n  if (typeof sceneState.viewBackgroundColor === \"string\") {\n    context.fillStyle = sceneState.viewBackgroundColor;\n    context.fillRect(0, 0, canvas.width, canvas.height);\n  } else {\n    context.clearRect(0, 0, canvas.width, canvas.height);\n  }\n  context.fillStyle = fillStyle;\n\n  sceneState = {\n    ...sceneState,\n    scrollX: typeof offsetX === \"number\" ? offsetX : sceneState.scrollX,\n    scrollY: typeof offsetY === \"number\" ? offsetY : sceneState.scrollY\n  };\n\n  elements.forEach(element => {\n    renderElement(element, rc, context, sceneState);\n  });\n\n  if (renderSelection) {\n    const selectedElements = elements.filter(el => el.isSelected);\n\n    selectedElements.forEach(element => {\n      const margin = 4;\n\n      const [\n        elementX1,\n        elementY1,\n        elementX2,\n        elementY2\n      ] = getElementAbsoluteCoords(element);\n      const lineDash = context.getLineDash();\n      context.setLineDash([8, 4]);\n      context.strokeRect(\n        elementX1 - margin + sceneState.scrollX,\n        elementY1 - margin + sceneState.scrollY,\n        elementX2 - elementX1 + margin * 2,\n        elementY2 - elementY1 + margin * 2\n      );\n      context.setLineDash(lineDash);\n    });\n\n    if (selectedElements.length === 1 && selectedElements[0].type !== \"text\") {\n      const handlers = handlerRectangles(selectedElements[0], sceneState);\n      Object.values(handlers).forEach(handler => {\n        context.strokeRect(handler[0], handler[1], handler[2], handler[3]);\n      });\n    }\n  }\n\n  if (renderScrollbars) {\n    const scrollBars = getScrollBars(\n      elements,\n      context.canvas.width / window.devicePixelRatio,\n      context.canvas.height / window.devicePixelRatio,\n      sceneState.scrollX,\n      sceneState.scrollY\n    );\n\n    const strokeStyle = context.strokeStyle;\n    context.fillStyle = SCROLLBAR_COLOR;\n    context.strokeStyle = \"rgba(255,255,255,0.8)\";\n    [scrollBars.horizontal, scrollBars.vertical].forEach(scrollBar => {\n      if (scrollBar)\n        roundRect(\n          context,\n          scrollBar.x,\n          scrollBar.y,\n          scrollBar.width,\n          scrollBar.height,\n          SCROLLBAR_WIDTH / 2\n        );\n    });\n    context.strokeStyle = strokeStyle;\n    context.fillStyle = fillStyle;\n  }\n}\n","import rough from \"roughjs/bin/wrappers/rough\";\n\nimport { ExcalidrawElement } from \"../element/types\";\n\nimport { getElementAbsoluteCoords } from \"../element\";\n\nimport { renderScene } from \"../renderer\";\nimport { AppState } from \"../types\";\nimport { ExportType } from \"./types\";\nimport nanoid from \"nanoid\";\n\nconst LOCAL_STORAGE_KEY = \"excalidraw\";\nconst LOCAL_STORAGE_KEY_STATE = \"excalidraw-state\";\n\nfunction saveFile(name: string, data: string) {\n  // create a temporary <a> elem which we'll use to download the image\n  const link = document.createElement(\"a\");\n  link.setAttribute(\"download\", name);\n  link.setAttribute(\"href\", data);\n  link.click();\n\n  // clean up\n  link.remove();\n}\n\ninterface DataState {\n  elements: readonly ExcalidrawElement[];\n  appState: any;\n}\n\nexport function saveAsJSON(\n  elements: readonly ExcalidrawElement[],\n  name: string\n) {\n  const serialized = JSON.stringify({\n    version: 1,\n    source: window.location.origin,\n    elements\n  });\n\n  saveFile(\n    `${name}.json`,\n    \"data:text/plain;charset=utf-8,\" + encodeURIComponent(serialized)\n  );\n}\n\nexport function loadFromJSON() {\n  const input = document.createElement(\"input\");\n  const reader = new FileReader();\n  input.type = \"file\";\n  input.accept = \".json\";\n\n  input.onchange = () => {\n    if (!input.files!.length) {\n      alert(\"A file was not selected.\");\n      return;\n    }\n\n    reader.readAsText(input.files![0], \"utf8\");\n  };\n\n  input.click();\n\n  return new Promise<DataState>(resolve => {\n    reader.onloadend = () => {\n      if (reader.readyState === FileReader.DONE) {\n        let elements = [];\n        try {\n          const data = JSON.parse(reader.result as string);\n          elements = data.elements || [];\n        } catch (e) {\n          // Do nothing because elements array is already empty\n        }\n        resolve(restore(elements, null));\n      }\n    };\n  });\n}\n\nexport function exportCanvas(\n  type: ExportType,\n  elements: readonly ExcalidrawElement[],\n  canvas: HTMLCanvasElement,\n  {\n    exportBackground,\n    exportPadding = 10,\n    viewBackgroundColor,\n    name\n  }: {\n    exportBackground: boolean;\n    exportPadding?: number;\n    viewBackgroundColor: string;\n    scrollX: number;\n    scrollY: number;\n    name: string;\n  }\n) {\n  if (!elements.length) return window.alert(\"Cannot export empty canvas.\");\n  // calculate smallest area to fit the contents in\n\n  let subCanvasX1 = Infinity;\n  let subCanvasX2 = 0;\n  let subCanvasY1 = Infinity;\n  let subCanvasY2 = 0;\n\n  elements.forEach(element => {\n    const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\n    subCanvasX1 = Math.min(subCanvasX1, x1);\n    subCanvasY1 = Math.min(subCanvasY1, y1);\n    subCanvasX2 = Math.max(subCanvasX2, x2);\n    subCanvasY2 = Math.max(subCanvasY2, y2);\n  });\n\n  function distance(x: number, y: number) {\n    return Math.abs(x > y ? x - y : y - x);\n  }\n\n  const tempCanvas = document.createElement(\"canvas\");\n  tempCanvas.style.display = \"none\";\n  document.body.appendChild(tempCanvas);\n  tempCanvas.width = distance(subCanvasX1, subCanvasX2) + exportPadding * 2;\n  tempCanvas.height = distance(subCanvasY1, subCanvasY2) + exportPadding * 2;\n\n  renderScene(\n    elements,\n    rough.canvas(tempCanvas),\n    tempCanvas,\n    {\n      viewBackgroundColor: exportBackground ? viewBackgroundColor : null,\n      scrollX: 0,\n      scrollY: 0\n    },\n    {\n      offsetX: -subCanvasX1 + exportPadding,\n      offsetY: -subCanvasY1 + exportPadding,\n      renderScrollbars: false,\n      renderSelection: false\n    }\n  );\n\n  if (type === \"png\") {\n    saveFile(`${name}.png`, tempCanvas.toDataURL(\"image/png\"));\n  } else if (type === \"clipboard\") {\n    try {\n      tempCanvas.toBlob(async function(blob) {\n        try {\n          await navigator.clipboard.write([\n            new window.ClipboardItem({ \"image/png\": blob })\n          ]);\n        } catch (err) {\n          window.alert(\"Couldn't copy to clipboard. Try using Chrome browser.\");\n        }\n      });\n    } catch (err) {\n      window.alert(\"Couldn't copy to clipboard. Try using Chrome browser.\");\n    }\n  }\n\n  // clean up the DOM\n  if (tempCanvas !== canvas) tempCanvas.remove();\n}\n\nfunction restore(\n  savedElements: readonly ExcalidrawElement[],\n  savedState: any\n): DataState {\n  return {\n    elements: savedElements.map(element => ({\n      ...element,\n      id: element.id || nanoid(),\n      fillStyle: element.fillStyle || \"hachure\",\n      strokeWidth: element.strokeWidth || 1,\n      roughness: element.roughness || 1,\n      opacity:\n        element.opacity === null || element.opacity === undefined\n          ? 100\n          : element.opacity\n    })),\n    appState: savedState\n  };\n}\n\nexport function restoreFromLocalStorage() {\n  const savedElements = localStorage.getItem(LOCAL_STORAGE_KEY);\n  const savedState = localStorage.getItem(LOCAL_STORAGE_KEY_STATE);\n\n  let elements = [];\n  if (savedElements) {\n    try {\n      elements = JSON.parse(savedElements);\n    } catch (e) {\n      // Do nothing because elements array is already empty\n    }\n  }\n\n  let appState = null;\n  if (savedState) {\n    try {\n      appState = JSON.parse(savedState);\n    } catch (e) {\n      // Do nothing because appState is already null\n    }\n  }\n\n  return restore(elements, appState);\n}\n\nexport function saveToLocalStorage(\n  elements: readonly ExcalidrawElement[],\n  state: AppState\n) {\n  localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(elements));\n  localStorage.setItem(LOCAL_STORAGE_KEY_STATE, JSON.stringify(state));\n}\n","import { ExcalidrawElement } from \"../element/types\";\nimport { hitTest } from \"../element/collision\";\nimport { getElementAbsoluteCoords } from \"../element\";\n\nexport const hasBackground = (elements: readonly ExcalidrawElement[]) =>\n  elements.some(\n    element =>\n      element.isSelected &&\n      (element.type === \"rectangle\" ||\n        element.type === \"ellipse\" ||\n        element.type === \"diamond\")\n  );\n\nexport const hasStroke = (elements: readonly ExcalidrawElement[]) =>\n  elements.some(\n    element =>\n      element.isSelected &&\n      (element.type === \"rectangle\" ||\n        element.type === \"ellipse\" ||\n        element.type === \"diamond\" ||\n        element.type === \"arrow\")\n  );\n\nexport const hasText = (elements: readonly ExcalidrawElement[]) =>\n  elements.some(element => element.isSelected && element.type === \"text\");\n\nexport function getElementAtPosition(\n  elements: readonly ExcalidrawElement[],\n  x: number,\n  y: number\n) {\n  let hitElement = null;\n  // We need to to hit testing from front (end of the array) to back (beginning of the array)\n  for (let i = elements.length - 1; i >= 0; --i) {\n    if (hitTest(elements[i], x, y)) {\n      hitElement = elements[i];\n      break;\n    }\n  }\n\n  return hitElement;\n}\n\nexport function getElementContainingPosition(\n  elements: readonly ExcalidrawElement[],\n  x: number,\n  y: number\n) {\n  let hitElement = null;\n  // We need to to hit testing from front (end of the array) to back (beginning of the array)\n  for (let i = elements.length - 1; i >= 0; --i) {\n    const [x1, y1, x2, y2] = getElementAbsoluteCoords(elements[i]);\n    if (x1 < x && x < x2 && y1 < y && y < y2) {\n      hitElement = elements[i];\n      break;\n    }\n  }\n  return hitElement;\n}\n","import { ExcalidrawElement } from \"../element/types\";\n\nexport const createScene = () => {\n  const elements: readonly ExcalidrawElement[] = [];\n  return { elements };\n};\n","import React from \"react\";\n\n// We inline font-awesome icons in order to save on js size rather than including the font awesome react library\nexport const SHAPES = [\n  {\n    icon: (\n      // fa-mouse-pointer\n      <svg viewBox=\"0 0 320 512\">\n        <path d=\"M302.189 329.126H196.105l55.831 135.993c3.889 9.428-.555 19.999-9.444 23.999l-49.165 21.427c-9.165 4-19.443-.571-23.332-9.714l-53.053-129.136-86.664 89.138C18.729 472.71 0 463.554 0 447.977V18.299C0 1.899 19.921-6.096 30.277 5.443l284.412 292.542c11.472 11.179 3.007 31.141-12.5 31.141z\" />\n      </svg>\n    ),\n    value: \"selection\"\n  },\n  {\n    icon: (\n      // fa-square\n      <svg viewBox=\"0 0 448 512\">\n        <path d=\"M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48z\" />\n      </svg>\n    ),\n    value: \"rectangle\"\n  },\n  {\n    icon: (\n      // custom\n      <svg viewBox=\"0 0 223.646 223.646\">\n        <path d=\"M111.823 0L16.622 111.823 111.823 223.646 207.025 111.823z\" />\n      </svg>\n    ),\n    value: \"diamond\"\n  },\n  {\n    icon: (\n      // fa-circle\n      <svg viewBox=\"0 0 512 512\">\n        <path d=\"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z\" />\n      </svg>\n    ),\n    value: \"ellipse\"\n  },\n  {\n    icon: (\n      // fa-long-arrow-alt-right\n      <svg viewBox=\"0 0 448 512\">\n        <path d=\"M313.941 216H12c-6.627 0-12 5.373-12 12v56c0 6.627 5.373 12 12 12h301.941v46.059c0 21.382 25.851 32.09 40.971 16.971l86.059-86.059c9.373-9.373 9.373-24.569 0-33.941l-86.059-86.059c-15.119-15.119-40.971-4.411-40.971 16.971V216z\" />\n      </svg>\n    ),\n    value: \"arrow\"\n  },\n  {\n    icon: (\n      // fa-font\n      <svg viewBox=\"0 0 448 512\">\n        <path d=\"M432 416h-23.41L277.88 53.69A32 32 0 0 0 247.58 32h-47.16a32 32 0 0 0-30.3 21.69L39.41 416H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h128a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16h-19.58l23.3-64h152.56l23.3 64H304a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h128a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM176.85 272L224 142.51 271.15 272z\" />\n      </svg>\n    ),\n    value: \"text\"\n  }\n];\n\nexport const shapesShortcutKeys = SHAPES.map(shape => shape.value[0]);\n\nexport function findShapeByKey(key: string) {\n  const defaultElement = \"selection\";\n  return SHAPES.reduce((element, shape) => {\n    if (shape.value[0] !== key) return element;\n\n    return shape.value;\n  }, defaultElement);\n}\n","import { ExcalidrawElement } from \"./element/types\";\n\nclass SceneHistory {\n  private recording: boolean = true;\n  private stateHistory: string[] = [];\n  private redoStack: string[] = [];\n\n  generateCurrentEntry(elements: readonly ExcalidrawElement[]) {\n    return JSON.stringify(\n      elements.map(element => ({ ...element, isSelected: false }))\n    );\n  }\n\n  pushEntry(newEntry: string) {\n    if (\n      this.stateHistory.length > 0 &&\n      this.stateHistory[this.stateHistory.length - 1] === newEntry\n    ) {\n      // If the last entry is the same as this one, ignore it\n      return;\n    }\n    this.stateHistory.push(newEntry);\n  }\n\n  restoreEntry(entry: string) {\n    // When restoring, we shouldn't add an history entry otherwise we'll be stuck with it and can't go back\n    this.skipRecording();\n\n    try {\n      return JSON.parse(entry);\n    } catch {\n      return null;\n    }\n  }\n\n  clearRedoStack() {\n    this.redoStack.splice(0, this.redoStack.length);\n  }\n\n  redoOnce(elements: readonly ExcalidrawElement[]) {\n    const currentEntry = this.generateCurrentEntry(elements);\n    const entryToRestore = this.redoStack.pop();\n    if (entryToRestore !== undefined) {\n      this.stateHistory.push(currentEntry);\n      return this.restoreEntry(entryToRestore);\n    }\n\n    return null;\n  }\n\n  undoOnce(elements: readonly ExcalidrawElement[]) {\n    const currentEntry = this.generateCurrentEntry(elements);\n    let entryToRestore = this.stateHistory.pop();\n\n    // If nothing was changed since last, take the previous one\n    if (currentEntry === entryToRestore) {\n      entryToRestore = this.stateHistory.pop();\n    }\n    if (entryToRestore !== undefined) {\n      this.redoStack.push(currentEntry);\n      return this.restoreEntry(entryToRestore);\n    }\n\n    return null;\n  }\n\n  isRecording() {\n    return this.recording;\n  }\n\n  skipRecording() {\n    this.recording = false;\n  }\n\n  resumeRecording() {\n    this.recording = true;\n  }\n}\n\nexport const createHistory: () => { history: SceneHistory } = () => {\n  const history = new SceneHistory();\n  return { history };\n};\n","import React from \"react\";\n\ntype Props = {\n  top?: number;\n  left?: number;\n  children?: React.ReactNode;\n  onCloseRequest?(): void;\n};\n\nexport function Popover({ children, left, onCloseRequest, top }: Props) {\n  return (\n    <div className=\"popover\" style={{ top: top, left: left }}>\n      <div\n        className=\"cover\"\n        onClick={onCloseRequest}\n        onContextMenu={e => {\n          e.preventDefault();\n          if (onCloseRequest) onCloseRequest();\n        }}\n      />\n      {children}\n    </div>\n  );\n}\n","import React from \"react\";\nimport { Popover } from \"./Popover\";\nimport { render, unmountComponentAtNode } from \"react-dom\";\n\nimport \"./ContextMenu.css\";\n\ntype ContextMenuOption = {\n  label: string;\n  action(): void;\n};\n\ntype Props = {\n  options: ContextMenuOption[];\n  onCloseRequest?(): void;\n  top: number;\n  left: number;\n};\n\nfunction ContextMenu({ options, onCloseRequest, top, left }: Props) {\n  return (\n    <Popover onCloseRequest={onCloseRequest} top={top} left={left}>\n      <ul className=\"context-menu\" onContextMenu={e => e.preventDefault()}>\n        {options.map((option, idx) => (\n          <li\n            key={idx}\n            className=\"context-menu__option\"\n            onClick={onCloseRequest}\n          >\n            <ContextMenuOption {...option} />\n          </li>\n        ))}\n      </ul>\n    </Popover>\n  );\n}\n\nfunction ContextMenuOption({ label, action }: ContextMenuOption) {\n  return (\n    <button className=\"context-menu-option\" onClick={action}>\n      {label}\n    </button>\n  );\n}\n\nlet contextMenuNode: HTMLDivElement;\nfunction getContextMenuNode(): HTMLDivElement {\n  if (contextMenuNode) {\n    return contextMenuNode;\n  }\n  const div = document.createElement(\"div\");\n  document.body.appendChild(div);\n  return (contextMenuNode = div);\n}\n\ntype ContextMenuParams = {\n  options: (ContextMenuOption | false | null | undefined)[];\n  top: number;\n  left: number;\n};\n\nfunction handleClose() {\n  unmountComponentAtNode(getContextMenuNode());\n}\n\nexport default {\n  push(params: ContextMenuParams) {\n    const options = Array.of<ContextMenuOption>();\n    params.options.forEach(option => {\n      if (option) {\n        options.push(option);\n      }\n    });\n    if (options.length) {\n      render(\n        <ContextMenu\n          top={params.top}\n          left={params.left}\n          options={options}\n          onCloseRequest={handleClose}\n        />,\n        getContextMenuNode()\n      );\n    }\n  }\n};\n","import React from \"react\";\nimport { Action, ActionsManagerInterface, UpdaterFn } from \"./types\";\nimport { ExcalidrawElement } from \"../element/types\";\nimport { AppState } from \"../types\";\n\nexport class ActionManager implements ActionsManagerInterface {\n  actions: { [keyProp: string]: Action } = {};\n\n  updater:\n    | ((elements: ExcalidrawElement[], appState: AppState) => void)\n    | null = null;\n\n  setUpdater(\n    updater: (elements: ExcalidrawElement[], appState: AppState) => void\n  ) {\n    this.updater = updater;\n  }\n\n  registerAction(action: Action) {\n    this.actions[action.name] = action;\n  }\n\n  handleKeyDown(\n    event: KeyboardEvent,\n    elements: readonly ExcalidrawElement[],\n    appState: AppState\n  ) {\n    const data = Object.values(this.actions)\n      .sort((a, b) => (b.keyPriority || 0) - (a.keyPriority || 0))\n      .filter(\n        action => action.keyTest && action.keyTest(event, elements, appState)\n      );\n\n    if (data.length === 0) return {};\n\n    event.preventDefault();\n    return data[0].perform(elements, appState, null);\n  }\n\n  getContextMenuItems(\n    elements: readonly ExcalidrawElement[],\n    appState: AppState,\n    updater: UpdaterFn\n  ) {\n    console.log(\n      Object.values(this.actions)\n        .filter(action => \"contextItemLabel\" in action)\n        .map(a => ({ name: a.name, label: a.contextItemLabel }))\n    );\n    return Object.values(this.actions)\n      .filter(action => \"contextItemLabel\" in action)\n      .sort(\n        (a, b) =>\n          (a.contextMenuOrder !== undefined ? a.contextMenuOrder : 999) -\n          (b.contextMenuOrder !== undefined ? b.contextMenuOrder : 999)\n      )\n      .map(action => ({\n        label: action.contextItemLabel!,\n        action: () => {\n          updater(action.perform(elements, appState, null));\n        }\n      }));\n  }\n\n  renderAction(\n    name: string,\n    elements: readonly ExcalidrawElement[],\n    appState: AppState,\n    updater: UpdaterFn\n  ) {\n    if (this.actions[name] && \"PanelComponent\" in this.actions[name]) {\n      const action = this.actions[name];\n      const PanelComponent = action.PanelComponent!;\n      const updateData = (formState: any) => {\n        updater(action.perform(elements, appState, formState));\n      };\n\n      return (\n        <PanelComponent\n          elements={elements}\n          appState={appState}\n          updateData={updateData}\n        />\n      );\n    }\n\n    return null;\n  }\n}\n","import React from \"react\";\nimport { Action } from \"./types\";\nimport { deleteSelectedElements } from \"../scene\";\nimport { KEYS } from \"../keys\";\n\nexport const actionDeleteSelected: Action = {\n  name: \"deleteSelectedElements\",\n  perform: elements => {\n    return {\n      elements: deleteSelectedElements(elements)\n    };\n  },\n  contextItemLabel: \"Delete\",\n  contextMenuOrder: 3,\n  keyTest: event => event.key === KEYS.BACKSPACE || event.key === KEYS.DELETE,\n  PanelComponent: ({ updateData }) => (\n    <button onClick={() => updateData(null)}>Delete selected</button>\n  )\n};\n","function swap<T>(elements: T[], indexA: number, indexB: number) {\n  const element = elements[indexA];\n  elements[indexA] = elements[indexB];\n  elements[indexB] = element;\n}\n\nexport function moveOneLeft<T>(elements: T[], indicesToMove: number[]) {\n  indicesToMove.sort((a: number, b: number) => a - b);\n  let isSorted = true;\n  // We go from left to right to avoid overriding the wrong elements\n  indicesToMove.forEach((index, i) => {\n    // We don't want to bubble the first elements that are sorted as they are\n    // already in their correct position\n    isSorted = isSorted && index === i;\n    if (isSorted) {\n      return;\n    }\n    swap(elements, index - 1, index);\n  });\n\n  return elements;\n}\n\nexport function moveOneRight<T>(elements: T[], indicesToMove: number[]) {\n  const reversedIndicesToMove = indicesToMove.sort(\n    (a: number, b: number) => b - a\n  );\n  let isSorted = true;\n\n  // We go from right to left to avoid overriding the wrong elements\n  reversedIndicesToMove.forEach((index, i) => {\n    // We don't want to bubble the first elements that are sorted as they are\n    // already in their correct position\n    isSorted = isSorted && index === elements.length - i - 1;\n    if (isSorted) {\n      return;\n    }\n    swap(elements, index + 1, index);\n  });\n  return elements;\n}\n\n// Let's go through an example\n//        |        |\n// [a, b, c, d, e, f, g]\n// -->\n// [c, f, a, b, d, e, g]\n//\n// We are going to override all the elements we want to move, so we keep them in an array\n// that we will restore at the end.\n// [c, f]\n//\n// From now on, we'll never read those values from the array anymore\n//        |1       |0\n// [a, b, _, d, e, _, g]\n//\n// The idea is that we want to shift all the elements between the marker 0 and 1\n// by one slot to the right.\n//\n//        |1       |0\n// [a, b, _, d, e, _, g]\n//          -> ->\n//\n// which gives us\n//\n//        |1       |0\n// [a, b, _, _, d, e, g]\n//\n// Now, we need to move all the elements from marker 1 to the beginning by two (not one)\n// slots to the right, which gives us\n//\n//        |1       |0\n// [a, b, _, _, d, e, g]\n//  ---|--^  ^\n//     ------|\n//\n// which gives us\n//\n//        |1       |0\n// [_, _, a, b, d, e, g]\n//\n// At this point, we can fill back the leftmost elements with the array we saved at\n// the beggining\n//\n//        |1       |0\n// [c, f, a, b, d, e, g]\n//\n// And we are done!\nexport function moveAllLeft<T>(elements: T[], indicesToMove: number[]) {\n  indicesToMove.sort((a: number, b: number) => a - b);\n\n  // Copy the elements to move\n  const leftMostElements = indicesToMove.map(index => elements[index]);\n\n  const reversedIndicesToMove = indicesToMove\n    // We go from right to left to avoid overriding elements.\n    .reverse()\n    // We add 0 for the final marker\n    .concat([0]);\n\n  reversedIndicesToMove.forEach((index, i) => {\n    // We skip the first one as it is not paired with anything else\n    if (i === 0) {\n      return;\n    }\n\n    // We go from the next marker to the right (i - 1) to the current one (index)\n    for (let pos = reversedIndicesToMove[i - 1] - 1; pos >= index; --pos) {\n      // We move by 1 the first time, 2 the second... So we can use the index i in the array\n      elements[pos + i] = elements[pos];\n    }\n  });\n\n  // The final step\n  leftMostElements.forEach((element, i) => {\n    elements[i] = element;\n  });\n\n  return elements;\n}\n\n// Let's go through an example\n//        |        |\n// [a, b, c, d, e, f, g]\n// -->\n// [a, b, d, e, g, c, f]\n//\n// We are going to override all the elements we want to move, so we keep them in an array\n// that we will restore at the end.\n// [c, f]\n//\n// From now on, we'll never read those values from the array anymore\n//        |0       |1\n// [a, b, _, d, e, _, g]\n//\n// The idea is that we want to shift all the elements between the marker 0 and 1\n// by one slot to the left.\n//\n//        |0       |1\n// [a, b, _, d, e, _, g]\n//          <- <-\n//\n// which gives us\n//\n//        |0       |1\n// [a, b, d, e, _, _, g]\n//\n// Now, we need to move all the elements from marker 1 to the end by two (not one)\n// slots to the left, which gives us\n//\n//        |0       |1\n// [a, b, d, e, _, _, g]\n//              ^------\n//\n// which gives us\n//\n//        |0       |1\n// [a, b, d, e, g, _, _]\n//\n// At this point, we can fill back the rightmost elements with the array we saved at\n// the beggining\n//\n//        |0       |1\n// [a, b, d, e, g, c, f]\n//\n// And we are done!\nexport function moveAllRight<T>(elements: T[], indicesToMove: number[]) {\n  const reversedIndicesToMove = indicesToMove.sort(\n    (a: number, b: number) => b - a\n  );\n\n  // Copy the elements to move\n  const rightMostElements = reversedIndicesToMove.map(index => elements[index]);\n\n  indicesToMove = reversedIndicesToMove\n    // We go from left to right to avoid overriding elements.\n    .reverse()\n    // We last element index for the final marker\n    .concat([elements.length]);\n\n  indicesToMove.forEach((index, i) => {\n    // We skip the first one as it is not paired with anything else\n    if (i === 0) {\n      return;\n    }\n\n    // We go from the next marker to the left (i - 1) to the current one (index)\n    for (let pos = indicesToMove[i - 1] + 1; pos < index; ++pos) {\n      // We move by 1 the first time, 2 the second... So we can use the index i in the array\n      elements[pos - i] = elements[pos];\n    }\n  });\n\n  // The final step\n  rightMostElements.forEach((element, i) => {\n    elements[elements.length - i - 1] = element;\n  });\n\n  return elements;\n}\n","import React from \"react\";\nimport { Action } from \"./types\";\nimport {\n  moveOneLeft,\n  moveOneRight,\n  moveAllLeft,\n  moveAllRight\n} from \"../zindex\";\nimport { getSelectedIndices } from \"../scene\";\nimport { META_KEY } from \"../keys\";\n\nexport const actionSendBackward: Action = {\n  name: \"sendBackward\",\n  perform: (elements, appState) => {\n    return {\n      elements: moveOneLeft([...elements], getSelectedIndices(elements)),\n      appState\n    };\n  },\n  contextItemLabel: \"Send Backward\",\n  keyPriority: 40,\n  keyTest: event =>\n    event[META_KEY] && event.shiftKey && event.altKey && event.code === \"KeyB\",\n  PanelComponent: ({ updateData }) => (\n    <button type=\"button\" onClick={e => updateData(null)}>\n      Send backward\n    </button>\n  )\n};\n\nexport const actionBringForward: Action = {\n  name: \"bringForward\",\n  perform: (elements, appState) => {\n    return {\n      elements: moveOneRight([...elements], getSelectedIndices(elements)),\n      appState\n    };\n  },\n  contextItemLabel: \"Bring Forward\",\n  keyPriority: 40,\n  keyTest: event =>\n    event[META_KEY] && event.shiftKey && event.altKey && event.code === \"KeyF\",\n  PanelComponent: ({ updateData }) => (\n    <button type=\"button\" onClick={e => updateData(null)}>\n      Bring Forward\n    </button>\n  )\n};\n\nexport const actionSendToBack: Action = {\n  name: \"sendToBack\",\n  perform: (elements, appState) => {\n    return {\n      elements: moveAllLeft([...elements], getSelectedIndices(elements)),\n      appState\n    };\n  },\n  contextItemLabel: \"Send to Back\",\n  keyTest: event => event[META_KEY] && event.shiftKey && event.code === \"KeyB\",\n  PanelComponent: ({ updateData }) => (\n    <button type=\"button\" onClick={e => updateData(null)}>\n      Send to Back\n    </button>\n  )\n};\n\nexport const actionBringToFront: Action = {\n  name: \"bringToFront\",\n  perform: (elements, appState) => {\n    return {\n      elements: moveAllRight([...elements], getSelectedIndices(elements)),\n      appState\n    };\n  },\n  contextItemLabel: \"Bring to Front\",\n  keyTest: event => event[META_KEY] && event.shiftKey && event.code === \"KeyF\",\n  PanelComponent: ({ updateData }) => (\n    <button type=\"button\" onClick={e => updateData(null)}>\n      Bring to Front\n    </button>\n  )\n};\n","import { Action } from \"./types\";\nimport { META_KEY } from \"../keys\";\n\nexport const actionSelectAll: Action = {\n  name: \"selectAll\",\n  perform: elements => {\n    return {\n      elements: elements.map(elem => ({ ...elem, isSelected: true }))\n    };\n  },\n  contextItemLabel: \"Select All\",\n  keyTest: event => event[META_KEY] && event.code === \"KeyA\"\n};\n","import React from \"react\";\n\nexport function ButtonSelect<T>({\n  options,\n  value,\n  onChange\n}: {\n  options: { value: T; text: string }[];\n  value: T | null;\n  onChange: (value: T) => void;\n}) {\n  return (\n    <div className=\"buttonList\">\n      {options.map(option => (\n        <button\n          key={option.text}\n          onClick={() => onChange(option.value)}\n          className={value === option.value ? \"active\" : \"\"}\n        >\n          {option.text}\n        </button>\n      ))}\n    </div>\n  );\n}\n","import React, { lazy } from \"react\";\nimport { Popover } from \"./Popover\";\n\nconst TwitterPicker = lazy(() =>\n  import(\n    /* webpackPrefetch: true */ \"react-color/lib/components/twitter/Twitter\"\n  )\n);\n\nexport function ColorPicker({\n  color,\n  onChange\n}: {\n  color: string | null;\n  onChange: (color: string) => void;\n}) {\n  const [isActive, setActive] = React.useState(false);\n  return (\n    <div>\n      <button\n        className=\"swatch\"\n        style={color ? { backgroundColor: color } : undefined}\n        onClick={() => setActive(!isActive)}\n      />\n      <React.Suspense fallback=\"\">\n        {isActive ? (\n          <Popover onCloseRequest={() => setActive(false)}>\n            <TwitterPicker\n              colors={[\n                \"#000000\",\n                \"#ABB8C3\",\n                \"#FFFFFF\",\n                \"#FF6900\",\n                \"#FCB900\",\n                \"#00D084\",\n                \"#8ED1FC\",\n                \"#0693E3\",\n                \"#EB144C\",\n                \"#F78DA7\",\n                \"#9900EF\"\n              ]}\n              width=\"205px\"\n              color={color || undefined}\n              onChange={changedColor => {\n                onChange(changedColor.hex);\n              }}\n            />\n          </Popover>\n        ) : null}\n      </React.Suspense>\n      <input\n        type=\"text\"\n        className=\"swatch-input\"\n        value={color || \"\"}\n        onPaste={e => onChange(e.clipboardData.getData(\"text\"))}\n        onChange={e => onChange(e.target.value)}\n      />\n    </div>\n  );\n}\n","import React from \"react\";\nimport { ColorPicker } from \"../ColorPicker\";\n\ninterface PanelColorProps {\n  title: string;\n  colorValue: string | null;\n  onColorChange: (value: string) => void;\n}\n\nexport const PanelColor: React.FC<PanelColorProps> = ({\n  title,\n  onColorChange,\n  colorValue\n}) => {\n  return (\n    <>\n      <h5>{title}</h5>\n      <ColorPicker\n        color={colorValue}\n        onChange={color => onColorChange(color)}\n      />\n    </>\n  );\n};\n","import React from \"react\";\nimport { Action } from \"./types\";\nimport { ExcalidrawElement, ExcalidrawTextElement } from \"../element/types\";\nimport { getSelectedAttribute } from \"../scene\";\nimport { ButtonSelect } from \"../components/ButtonSelect\";\nimport { PanelColor } from \"../components/panels/PanelColor\";\nimport { isTextElement, redrawTextBoundingBox } from \"../element\";\n\nconst changeProperty = (\n  elements: readonly ExcalidrawElement[],\n  callback: (element: ExcalidrawElement) => ExcalidrawElement\n) => {\n  return elements.map(element => {\n    if (element.isSelected) {\n      return callback(element);\n    }\n    return element;\n  });\n};\n\nexport const actionChangeStrokeColor: Action = {\n  name: \"changeStrokeColor\",\n  perform: (elements, appState, value) => {\n    return {\n      elements: changeProperty(elements, el => ({\n        ...el,\n        strokeColor: value\n      })),\n      appState: { ...appState, currentItemStrokeColor: value }\n    };\n  },\n  PanelComponent: ({ elements, appState, updateData }) => (\n    <PanelColor\n      title=\"Stroke Color\"\n      onColorChange={(color: string) => {\n        updateData(color);\n      }}\n      colorValue={getSelectedAttribute(\n        elements,\n        element => element.strokeColor\n      )}\n    />\n  )\n};\n\nexport const actionChangeBackgroundColor: Action = {\n  name: \"changeBackgroundColor\",\n  perform: (elements, appState, value) => {\n    return {\n      elements: changeProperty(elements, el => ({\n        ...el,\n        backgroundColor: value\n      })),\n      appState: { ...appState, currentItemBackgroundColor: value }\n    };\n  },\n  PanelComponent: ({ elements, updateData }) => (\n    <PanelColor\n      title=\"Background Color\"\n      onColorChange={(color: string) => {\n        updateData(color);\n      }}\n      colorValue={getSelectedAttribute(\n        elements,\n        element => element.backgroundColor\n      )}\n    />\n  )\n};\n\nexport const actionChangeFillStyle: Action = {\n  name: \"changeFillStyle\",\n  perform: (elements, appState, value) => {\n    return {\n      elements: changeProperty(elements, el => ({\n        ...el,\n        fillStyle: value\n      }))\n    };\n  },\n  PanelComponent: ({ elements, updateData }) => (\n    <>\n      <h5>Fill</h5>\n      <ButtonSelect\n        options={[\n          { value: \"solid\", text: \"Solid\" },\n          { value: \"hachure\", text: \"Hachure\" },\n          { value: \"cross-hatch\", text: \"Cross-hatch\" }\n        ]}\n        value={getSelectedAttribute(elements, element => element.fillStyle)}\n        onChange={value => {\n          updateData(value);\n        }}\n      />\n    </>\n  )\n};\n\nexport const actionChangeStrokeWidth: Action = {\n  name: \"changeStrokeWidth\",\n  perform: (elements, appState, value) => {\n    return {\n      elements: changeProperty(elements, el => ({\n        ...el,\n        strokeWidth: value\n      }))\n    };\n  },\n  PanelComponent: ({ elements, appState, updateData }) => (\n    <>\n      <h5>Stroke Width</h5>\n      <ButtonSelect\n        options={[\n          { value: 1, text: \"Thin\" },\n          { value: 2, text: \"Bold\" },\n          { value: 4, text: \"Extra Bold\" }\n        ]}\n        value={getSelectedAttribute(elements, element => element.strokeWidth)}\n        onChange={value => updateData(value)}\n      />\n    </>\n  )\n};\n\nexport const actionChangeSloppiness: Action = {\n  name: \"changeSloppiness\",\n  perform: (elements, appState, value) => {\n    return {\n      elements: changeProperty(elements, el => ({\n        ...el,\n        roughness: value\n      }))\n    };\n  },\n  PanelComponent: ({ elements, appState, updateData }) => (\n    <>\n      <h5>Sloppiness</h5>\n      <ButtonSelect\n        options={[\n          { value: 0, text: \"Draftsman\" },\n          { value: 1, text: \"Artist\" },\n          { value: 3, text: \"Cartoonist\" }\n        ]}\n        value={getSelectedAttribute(elements, element => element.roughness)}\n        onChange={value => updateData(value)}\n      />\n    </>\n  )\n};\n\nexport const actionChangeOpacity: Action = {\n  name: \"changeOpacity\",\n  perform: (elements, appState, value) => {\n    return {\n      elements: changeProperty(elements, el => ({\n        ...el,\n        opacity: value\n      }))\n    };\n  },\n  PanelComponent: ({ elements, updateData }) => (\n    <>\n      <h5>Opacity</h5>\n      <input\n        type=\"range\"\n        min=\"0\"\n        max=\"100\"\n        onChange={e => updateData(+e.target.value)}\n        value={\n          getSelectedAttribute(elements, element => element.opacity) ||\n          0 /* Put the opacity at 0 if there are two conflicting ones */\n        }\n      />\n    </>\n  )\n};\n\nexport const actionChangeFontSize: Action = {\n  name: \"changeFontSize\",\n  perform: (elements, appState, value) => {\n    return {\n      elements: changeProperty(elements, el => {\n        if (isTextElement(el)) {\n          const element: ExcalidrawTextElement = {\n            ...el,\n            font: `${value}px ${el.font.split(\"px \")[1]}`\n          };\n          redrawTextBoundingBox(element);\n          return element;\n        }\n\n        return el;\n      })\n    };\n  },\n  PanelComponent: ({ elements, updateData }) => (\n    <>\n      <h5>Font size</h5>\n      <ButtonSelect\n        options={[\n          { value: 16, text: \"Small\" },\n          { value: 20, text: \"Medium\" },\n          { value: 28, text: \"Large\" },\n          { value: 36, text: \"Very Large\" }\n        ]}\n        value={getSelectedAttribute(\n          elements,\n          element => isTextElement(element) && +element.font.split(\"px \")[0]\n        )}\n        onChange={value => updateData(value)}\n      />\n    </>\n  )\n};\n\nexport const actionChangeFontFamily: Action = {\n  name: \"changeFontFamily\",\n  perform: (elements, appState, value) => {\n    return {\n      elements: changeProperty(elements, el => {\n        if (isTextElement(el)) {\n          const element: ExcalidrawTextElement = {\n            ...el,\n            font: `${el.font.split(\"px \")[0]}px ${value}`\n          };\n          redrawTextBoundingBox(element);\n          return element;\n        }\n\n        return el;\n      })\n    };\n  },\n  PanelComponent: ({ elements, updateData }) => (\n    <>\n      <h5>Font family</h5>\n      <ButtonSelect\n        options={[\n          { value: \"Virgil\", text: \"Virgil\" },\n          { value: \"Helvetica\", text: \"Helvetica\" },\n          { value: \"Courier\", text: \"Courier\" }\n        ]}\n        value={getSelectedAttribute(\n          elements,\n          element => isTextElement(element) && element.font.split(\"px \")[1]\n        )}\n        onChange={value => updateData(value)}\n      />\n    </>\n  )\n};\n","import React from \"react\";\nimport { Action } from \"./types\";\nimport { ColorPicker } from \"../components/ColorPicker\";\n\nexport const actionChangeViewBackgroundColor: Action = {\n  name: \"changeViewBackgroundColor\",\n  perform: (elements, appState, value) => {\n    return { appState: { ...appState, viewBackgroundColor: value } };\n  },\n  PanelComponent: ({ appState, updateData }) => (\n    <>\n      <h5>Canvas Background Color</h5>\n      <ColorPicker\n        color={appState.viewBackgroundColor}\n        onChange={color => updateData(color)}\n      />\n    </>\n  )\n};\n\nexport const actionClearCanvas: Action = {\n  name: \"clearCanvas\",\n  perform: (elements, appState, value) => {\n    return {\n      elements: [],\n      appState: {\n        ...appState,\n        viewBackgroundColor: \"#ffffff\",\n        scrollX: 0,\n        scrollY: 0\n      }\n    };\n  },\n  PanelComponent: ({ updateData }) => (\n    <button\n      type=\"button\"\n      onClick={() => {\n        if (window.confirm(\"This will clear the whole canvas. Are you sure?\")) {\n          updateData(null);\n        }\n      }}\n      title=\"Clear the canvas & reset background color\"\n    >\n      Clear canvas\n    </button>\n  )\n};\n","import React, { Fragment, Component } from \"react\";\n\ntype InputState = {\n  value: string;\n  edit: boolean;\n};\n\ntype Props = {\n  value: string;\n  onChange: (value: string) => void;\n};\n\nexport class EditableText extends Component<Props, InputState> {\n  constructor(props: Props) {\n    super(props);\n\n    this.state = {\n      value: props.value,\n      edit: false\n    };\n  }\n\n  UNSAFE_componentWillReceiveProps(props: Props) {\n    this.setState({ value: props.value });\n  }\n\n  private handleEdit(e: React.ChangeEvent<HTMLInputElement>) {\n    this.setState({ value: e.target.value });\n  }\n\n  private handleBlur() {\n    const { value } = this.state;\n\n    if (!value) {\n      this.setState({ value: this.props.value, edit: false });\n      return;\n    }\n    this.props.onChange(value);\n    this.setState({ edit: false });\n  }\n\n  public render() {\n    const { value, edit } = this.state;\n\n    return (\n      <Fragment>\n        {edit ? (\n          <input\n            className=\"project-name-input\"\n            name=\"name\"\n            maxLength={25}\n            value={value}\n            onChange={e => this.handleEdit(e)}\n            onBlur={() => this.handleBlur()}\n            onKeyDown={e => {\n              if (e.key === \"Enter\") {\n                this.handleBlur();\n              }\n            }}\n            autoFocus\n          />\n        ) : (\n          <span\n            onClick={() => this.setState({ edit: true })}\n            className=\"project-name\"\n          >\n            {value}\n          </span>\n        )}\n      </Fragment>\n    );\n  }\n}\n","import React from \"react\";\nimport { Action } from \"./types\";\nimport { EditableText } from \"../components/EditableText\";\nimport { saveAsJSON, loadFromJSON } from \"../scene\";\n\nexport const actionChangeProjectName: Action = {\n  name: \"changeProjectName\",\n  perform: (elements, appState, value) => {\n    return { appState: { ...appState, name: value } };\n  },\n  PanelComponent: ({ appState, updateData }) => (\n    <>\n      <h5>Name</h5>\n      {appState.name && (\n        <EditableText\n          value={appState.name}\n          onChange={(name: string) => updateData(name)}\n        />\n      )}\n    </>\n  )\n};\n\nexport const actionChangeExportBackground: Action = {\n  name: \"changeExportBackground\",\n  perform: (elements, appState, value) => {\n    return { appState: { ...appState, exportBackground: value } };\n  },\n  PanelComponent: ({ appState, updateData }) => (\n    <label>\n      <input\n        type=\"checkbox\"\n        checked={appState.exportBackground}\n        onChange={e => {\n          updateData(e.target.checked);\n        }}\n      />\n      background\n    </label>\n  )\n};\n\nexport const actionSaveScene: Action = {\n  name: \"saveScene\",\n  perform: (elements, appState, value) => {\n    saveAsJSON(elements, appState.name);\n    return {};\n  },\n  PanelComponent: ({ updateData }) => (\n    <button onClick={() => updateData(null)}>Save as...</button>\n  )\n};\n\nexport const actionLoadScene: Action = {\n  name: \"loadScene\",\n  perform: (elements, appState, loadedElements) => {\n    return { elements: loadedElements };\n  },\n  PanelComponent: ({ updateData }) => (\n    <button\n      onClick={() => {\n        loadFromJSON().then(({ elements }) => {\n          updateData(elements);\n        });\n      }}\n    >\n      Load file...\n    </button>\n  )\n};\n","import { Action } from \"./types\";\nimport { isTextElement, redrawTextBoundingBox } from \"../element\";\nimport { META_KEY } from \"../keys\";\n\nlet copiedStyles: string = \"{}\";\n\nexport const actionCopyStyles: Action = {\n  name: \"copyStyles\",\n  perform: elements => {\n    const element = elements.find(el => el.isSelected);\n    if (element) {\n      copiedStyles = JSON.stringify(element);\n    }\n    return {};\n  },\n  contextItemLabel: \"Copy Styles\",\n  keyTest: event => event[META_KEY] && event.shiftKey && event.code === \"KeyC\",\n  contextMenuOrder: 0\n};\n\nexport const actionPasteStyles: Action = {\n  name: \"pasteStyles\",\n  perform: elements => {\n    const pastedElement = JSON.parse(copiedStyles);\n    return {\n      elements: elements.map(element => {\n        if (element.isSelected) {\n          const newElement = {\n            ...element,\n            backgroundColor: pastedElement?.backgroundColor,\n            strokeWidth: pastedElement?.strokeWidth,\n            strokeColor: pastedElement?.strokeColor,\n            fillStyle: pastedElement?.fillStyle,\n            opacity: pastedElement?.opacity,\n            roughness: pastedElement?.roughness\n          };\n          if (isTextElement(newElement)) {\n            newElement.font = pastedElement?.font;\n            redrawTextBoundingBox(newElement);\n          }\n          return newElement;\n        }\n        return element;\n      })\n    };\n  },\n  contextItemLabel: \"Paste Styles\",\n  keyTest: event => event[META_KEY] && event.shiftKey && event.code === \"KeyV\",\n  contextMenuOrder: 1\n};\n","import React, { useState } from \"react\";\n\ninterface PanelProps {\n  title: string;\n  defaultCollapsed?: boolean;\n  hide?: boolean;\n}\n\nexport const Panel: React.FC<PanelProps> = ({\n  title,\n  children,\n  defaultCollapsed = false,\n  hide = false\n}) => {\n  const [collapsed, setCollapsed] = useState(defaultCollapsed);\n\n  if (hide) return null;\n\n  return (\n    <div className=\"panel\">\n      <h4>{title}</h4>\n      <button\n        className=\"btn-panel-collapse\"\n        type=\"button\"\n        onClick={e => {\n          e.preventDefault();\n          setCollapsed(collapsed => !collapsed);\n        }}\n      >\n        {\n          <span\n            className={`btn-panel-collapse-icon ${\n              collapsed ? \"btn-panel-collapse-icon-closed\" : \"\"\n            }`}\n          >\n            \n          </span>\n        }\n      </button>\n      {!collapsed && <div className=\"panelColumn\">{children}</div>}\n    </div>\n  );\n};\n","import React from \"react\";\n\nimport { SHAPES } from \"../../shapes\";\nimport { capitalizeString } from \"../../utils\";\nimport { Panel } from \"../Panel\";\n\ninterface PanelToolsProps {\n  activeTool: string;\n  onToolChange: (value: string) => void;\n}\n\nexport const PanelTools: React.FC<PanelToolsProps> = ({\n  activeTool,\n  onToolChange\n}) => {\n  return (\n    <Panel title=\"Shapes\">\n      <div className=\"panelTools\">\n        {SHAPES.map(({ value, icon }) => (\n          <label\n            key={value}\n            className=\"tool\"\n            title={`${capitalizeString(value)} - ${capitalizeString(value)[0]}`}\n          >\n            <input\n              type=\"radio\"\n              checked={activeTool === value}\n              onChange={() => {\n                onToolChange(value);\n              }}\n            />\n            <div className=\"toolIcon\">{icon}</div>\n          </label>\n        ))}\n      </div>\n    </Panel>\n  );\n};\n","import React from \"react\";\nimport { ActionManager } from \"../../actions\";\nimport { ExcalidrawElement } from \"../../element/types\";\nimport { AppState } from \"../../types\";\nimport { UpdaterFn } from \"../../actions/types\";\n\ninterface PanelSelectionProps {\n  actionManager: ActionManager;\n  elements: readonly ExcalidrawElement[];\n  appState: AppState;\n  syncActionResult: UpdaterFn;\n}\n\nexport const PanelSelection: React.FC<PanelSelectionProps> = ({\n  actionManager,\n  elements,\n  appState,\n  syncActionResult\n}) => {\n  return (\n    <div>\n      <div className=\"buttonList\">\n        {actionManager.renderAction(\n          \"bringForward\",\n          elements,\n          appState,\n          syncActionResult\n        )}\n        {actionManager.renderAction(\n          \"bringToFront\",\n          elements,\n          appState,\n          syncActionResult\n        )}\n        {actionManager.renderAction(\n          \"sendBackward\",\n          elements,\n          appState,\n          syncActionResult\n        )}\n        {actionManager.renderAction(\n          \"sendToBack\",\n          elements,\n          appState,\n          syncActionResult\n        )}\n      </div>\n    </div>\n  );\n};\n","import React from \"react\";\n\nimport { Panel } from \"../Panel\";\nimport { ActionManager } from \"../../actions\";\nimport { ExcalidrawElement } from \"../../element/types\";\nimport { AppState } from \"../../types\";\nimport { UpdaterFn } from \"../../actions/types\";\n\ninterface PanelCanvasProps {\n  actionManager: ActionManager;\n  elements: readonly ExcalidrawElement[];\n  appState: AppState;\n  syncActionResult: UpdaterFn;\n}\n\nexport const PanelCanvas: React.FC<PanelCanvasProps> = ({\n  actionManager,\n  elements,\n  appState,\n  syncActionResult\n}) => {\n  return (\n    <Panel title=\"Canvas\">\n      {actionManager.renderAction(\n        \"changeViewBackgroundColor\",\n        elements,\n        appState,\n        syncActionResult\n      )}\n\n      {actionManager.renderAction(\n        \"clearCanvas\",\n        elements,\n        appState,\n        syncActionResult\n      )}\n    </Panel>\n  );\n};\n","import React from \"react\";\nimport { Panel } from \"../Panel\";\nimport { ExportType } from \"../../scene/types\";\n\nimport \"./panelExport.scss\";\nimport { ActionManager } from \"../../actions\";\nimport { ExcalidrawElement } from \"../../element/types\";\nimport { AppState } from \"../../types\";\nimport { UpdaterFn } from \"../../actions/types\";\n\ninterface PanelExportProps {\n  actionManager: ActionManager;\n  elements: readonly ExcalidrawElement[];\n  appState: AppState;\n  syncActionResult: UpdaterFn;\n  onExportCanvas: (type: ExportType) => void;\n}\n\n// fa-clipboard\nconst ClipboardIcon = () => (\n  <svg viewBox=\"0 0 384 512\">\n    <path\n      fill=\"currentColor\"\n      d=\"M384 112v352c0 26.51-21.49 48-48 48H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h80c0-35.29 28.71-64 64-64s64 28.71 64 64h80c26.51 0 48 21.49 48 48zM192 40c-13.255 0-24 10.745-24 24s10.745 24 24 24 24-10.745 24-24-10.745-24-24-24m96 114v-20a6 6 0 0 0-6-6H102a6 6 0 0 0-6 6v20a6 6 0 0 0 6 6h180a6 6 0 0 0 6-6z\"\n    ></path>\n  </svg>\n);\n\nconst probablySupportsClipboard =\n  \"toBlob\" in HTMLCanvasElement.prototype &&\n  \"clipboard\" in navigator &&\n  \"write\" in navigator.clipboard &&\n  \"ClipboardItem\" in window;\n\nexport const PanelExport: React.FC<PanelExportProps> = ({\n  actionManager,\n  elements,\n  appState,\n  syncActionResult,\n  onExportCanvas\n}) => {\n  return (\n    <Panel title=\"Export\">\n      <div className=\"panelColumn\">\n        {actionManager.renderAction(\n          \"changeProjectName\",\n          elements,\n          appState,\n          syncActionResult\n        )}\n        <h5>Image</h5>\n        <div className=\"panelExport-imageButtons\">\n          <button\n            className=\"panelExport-exportToPngButton\"\n            onClick={() => onExportCanvas(\"png\")}\n          >\n            Export to PNG\n          </button>\n          {probablySupportsClipboard && (\n            <button\n              className=\"panelExport-exportToClipboardButton\"\n              onClick={() => onExportCanvas(\"clipboard\")}\n              title=\"Copy to clipboard (experimental)\"\n            >\n              <ClipboardIcon />\n            </button>\n          )}\n        </div>\n        {actionManager.renderAction(\n          \"changeExportBackground\",\n          elements,\n          appState,\n          syncActionResult\n        )}\n\n        <h5>Scene</h5>\n        {actionManager.renderAction(\n          \"saveScene\",\n          elements,\n          appState,\n          syncActionResult\n        )}\n        {actionManager.renderAction(\n          \"loadScene\",\n          elements,\n          appState,\n          syncActionResult\n        )}\n      </div>\n    </Panel>\n  );\n};\n","import React from \"react\";\nimport { PanelTools } from \"./panels/PanelTools\";\nimport { Panel } from \"./Panel\";\nimport { PanelSelection } from \"./panels/PanelSelection\";\nimport {\n  hasBackground,\n  someElementIsSelected,\n  hasStroke,\n  hasText,\n  exportCanvas\n} from \"../scene\";\nimport { ExcalidrawElement } from \"../element/types\";\nimport { PanelCanvas } from \"./panels/PanelCanvas\";\nimport { PanelExport } from \"./panels/PanelExport\";\nimport { ExportType } from \"../scene/types\";\nimport { AppState } from \"../types\";\nimport { ActionManager } from \"../actions\";\nimport { UpdaterFn } from \"../actions/types\";\n\ninterface SidePanelProps {\n  actionManager: ActionManager;\n  elements: readonly ExcalidrawElement[];\n  syncActionResult: UpdaterFn;\n  appState: AppState;\n  onToolChange: (elementType: string) => void;\n  canvas: HTMLCanvasElement;\n}\n\nexport const SidePanel: React.FC<SidePanelProps> = ({\n  actionManager,\n  syncActionResult,\n  elements,\n  onToolChange,\n  appState,\n  canvas\n}) => {\n  return (\n    <div className=\"sidePanel\">\n      <PanelTools\n        activeTool={appState.elementType}\n        onToolChange={value => {\n          onToolChange(value);\n        }}\n      />\n      <Panel title=\"Selection\" hide={!someElementIsSelected(elements)}>\n        <PanelSelection\n          actionManager={actionManager}\n          syncActionResult={syncActionResult}\n          elements={elements}\n          appState={appState}\n        />\n\n        {actionManager.renderAction(\n          \"changeStrokeColor\",\n          elements,\n          appState,\n          syncActionResult\n        )}\n\n        {hasBackground(elements) && (\n          <>\n            {actionManager.renderAction(\n              \"changeBackgroundColor\",\n              elements,\n              appState,\n              syncActionResult\n            )}\n\n            {actionManager.renderAction(\n              \"changeFillStyle\",\n              elements,\n              appState,\n              syncActionResult\n            )}\n          </>\n        )}\n\n        {hasStroke(elements) && (\n          <>\n            {actionManager.renderAction(\n              \"changeStrokeWidth\",\n              elements,\n              appState,\n              syncActionResult\n            )}\n\n            {actionManager.renderAction(\n              \"changeSloppiness\",\n              elements,\n              appState,\n              syncActionResult\n            )}\n          </>\n        )}\n\n        {hasText(elements) && (\n          <>\n            {actionManager.renderAction(\n              \"changeFontSize\",\n              elements,\n              appState,\n              syncActionResult\n            )}\n\n            {actionManager.renderAction(\n              \"changeFontFamily\",\n              elements,\n              appState,\n              syncActionResult\n            )}\n          </>\n        )}\n\n        {actionManager.renderAction(\n          \"changeOpacity\",\n          elements,\n          appState,\n          syncActionResult\n        )}\n\n        {actionManager.renderAction(\n          \"deleteSelectedElements\",\n          elements,\n          appState,\n          syncActionResult\n        )}\n      </Panel>\n      <PanelCanvas\n        actionManager={actionManager}\n        syncActionResult={syncActionResult}\n        elements={elements}\n        appState={appState}\n      />\n      <PanelExport\n        actionManager={actionManager}\n        syncActionResult={syncActionResult}\n        elements={elements}\n        appState={appState}\n        onExportCanvas={(type: ExportType) =>\n          exportCanvas(type, elements, canvas, appState)\n        }\n      />\n    </div>\n  );\n};\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\n\nimport rough from \"roughjs/bin/wrappers/rough\";\nimport { RoughCanvas } from \"roughjs/bin/canvas\";\n\nimport {\n  newElement,\n  duplicateElement,\n  resizeTest,\n  isTextElement,\n  textWysiwyg,\n  getElementAbsoluteCoords\n} from \"./element\";\nimport {\n  clearSelection,\n  deleteSelectedElements,\n  setSelection,\n  isOverScrollBars,\n  restoreFromLocalStorage,\n  saveToLocalStorage,\n  getElementAtPosition,\n  createScene,\n  getElementContainingPosition\n} from \"./scene\";\n\nimport { renderScene } from \"./renderer\";\nimport { AppState } from \"./types\";\nimport { ExcalidrawElement, ExcalidrawTextElement } from \"./element/types\";\n\nimport { getDateTime, isInputLike, measureText } from \"./utils\";\nimport { KEYS, META_KEY, isArrowKey } from \"./keys\";\n\nimport { findShapeByKey, shapesShortcutKeys } from \"./shapes\";\nimport { createHistory } from \"./history\";\n\nimport ContextMenu from \"./components/ContextMenu\";\n\nimport \"./styles.scss\";\nimport { getElementWithResizeHandler } from \"./element/resizeTest\";\nimport {\n  ActionManager,\n  actionDeleteSelected,\n  actionSendBackward,\n  actionBringForward,\n  actionSendToBack,\n  actionBringToFront,\n  actionSelectAll,\n  actionChangeStrokeColor,\n  actionChangeBackgroundColor,\n  actionChangeOpacity,\n  actionChangeStrokeWidth,\n  actionChangeFillStyle,\n  actionChangeSloppiness,\n  actionChangeFontSize,\n  actionChangeFontFamily,\n  actionChangeViewBackgroundColor,\n  actionClearCanvas,\n  actionChangeProjectName,\n  actionChangeExportBackground,\n  actionLoadScene,\n  actionSaveScene,\n  actionCopyStyles,\n  actionPasteStyles\n} from \"./actions\";\nimport { SidePanel } from \"./components/SidePanel\";\nimport { ActionResult } from \"./actions/types\";\n\nlet { elements } = createScene();\nconst { history } = createHistory();\nconst DEFAULT_PROJECT_NAME = `excalidraw-${getDateTime()}`;\n\nconst CANVAS_WINDOW_OFFSET_LEFT = 250;\nconst CANVAS_WINDOW_OFFSET_TOP = 0;\n\nfunction resetCursor() {\n  document.documentElement.style.cursor = \"\";\n}\n\nfunction addTextElement(\n  element: ExcalidrawTextElement,\n  text: string,\n  font: string\n) {\n  resetCursor();\n  if (text === null || text === \"\") {\n    return false;\n  }\n\n  const metrics = measureText(text, font);\n  element.text = text;\n  element.font = font;\n  // Center the text\n  element.x -= metrics.width / 2;\n  element.y -= metrics.height / 2;\n  element.width = metrics.width;\n  element.height = metrics.height;\n  element.baseline = metrics.baseline;\n\n  return true;\n}\n\nconst ELEMENT_SHIFT_TRANSLATE_AMOUNT = 5;\nconst ELEMENT_TRANSLATE_AMOUNT = 1;\nconst TEXT_TO_CENTER_SNAP_THRESHOLD = 30;\n\nlet lastCanvasWidth = -1;\nlet lastCanvasHeight = -1;\n\nlet lastMouseUp: ((e: any) => void) | null = null;\n\nexport function viewportCoordsToSceneCoords(\n  { clientX, clientY }: { clientX: number; clientY: number },\n  { scrollX, scrollY }: { scrollX: number; scrollY: number }\n) {\n  const x = clientX - CANVAS_WINDOW_OFFSET_LEFT - scrollX;\n  const y = clientY - CANVAS_WINDOW_OFFSET_TOP - scrollY;\n  return { x, y };\n}\n\nexport class App extends React.Component<{}, AppState> {\n  canvas: HTMLCanvasElement | null = null;\n  rc: RoughCanvas | null = null;\n\n  actionManager: ActionManager = new ActionManager();\n  constructor(props: any) {\n    super(props);\n    this.actionManager.registerAction(actionDeleteSelected);\n    this.actionManager.registerAction(actionSendToBack);\n    this.actionManager.registerAction(actionBringToFront);\n    this.actionManager.registerAction(actionSendBackward);\n    this.actionManager.registerAction(actionBringForward);\n    this.actionManager.registerAction(actionSelectAll);\n\n    this.actionManager.registerAction(actionChangeStrokeColor);\n    this.actionManager.registerAction(actionChangeBackgroundColor);\n    this.actionManager.registerAction(actionChangeFillStyle);\n    this.actionManager.registerAction(actionChangeStrokeWidth);\n    this.actionManager.registerAction(actionChangeOpacity);\n    this.actionManager.registerAction(actionChangeSloppiness);\n    this.actionManager.registerAction(actionChangeFontSize);\n    this.actionManager.registerAction(actionChangeFontFamily);\n\n    this.actionManager.registerAction(actionChangeViewBackgroundColor);\n    this.actionManager.registerAction(actionClearCanvas);\n\n    this.actionManager.registerAction(actionChangeProjectName);\n    this.actionManager.registerAction(actionChangeExportBackground);\n    this.actionManager.registerAction(actionSaveScene);\n    this.actionManager.registerAction(actionLoadScene);\n\n    this.actionManager.registerAction(actionCopyStyles);\n    this.actionManager.registerAction(actionPasteStyles);\n  }\n\n  private syncActionResult = (res: ActionResult) => {\n    if (res.elements !== undefined) {\n      elements = res.elements;\n      this.forceUpdate();\n    }\n\n    if (res.appState !== undefined) {\n      this.setState({ ...res.appState });\n    }\n  };\n\n  public componentDidMount() {\n    document.addEventListener(\"keydown\", this.onKeyDown, false);\n    document.addEventListener(\"mousemove\", this.getCurrentCursorPosition);\n    window.addEventListener(\"resize\", this.onResize, false);\n\n    const { elements: newElements, appState } = restoreFromLocalStorage();\n\n    if (newElements) {\n      elements = newElements;\n    }\n\n    if (appState) {\n      this.setState(appState);\n    } else {\n      this.forceUpdate();\n    }\n  }\n\n  public componentWillUnmount() {\n    document.removeEventListener(\"keydown\", this.onKeyDown, false);\n    document.removeEventListener(\n      \"mousemove\",\n      this.getCurrentCursorPosition,\n      false\n    );\n    window.removeEventListener(\"resize\", this.onResize, false);\n  }\n\n  public state: AppState = {\n    draggingElement: null,\n    resizingElement: null,\n    elementType: \"selection\",\n    exportBackground: true,\n    currentItemStrokeColor: \"#000000\",\n    currentItemBackgroundColor: \"#ffffff\",\n    currentItemFont: \"20px Virgil\",\n    viewBackgroundColor: \"#ffffff\",\n    scrollX: 0,\n    scrollY: 0,\n    cursorX: 0,\n    cursorY: 0,\n    name: DEFAULT_PROJECT_NAME\n  };\n\n  private onResize = () => {\n    this.forceUpdate();\n  };\n\n  private getCurrentCursorPosition = (e: MouseEvent) => {\n    this.setState({ cursorX: e.x, cursorY: e.y });\n  };\n\n  private onKeyDown = (event: KeyboardEvent) => {\n    if (event.key === KEYS.ESCAPE) {\n      elements = clearSelection(elements);\n      this.forceUpdate();\n      this.setState({ elementType: \"selection\" });\n      if (window.document.activeElement instanceof HTMLElement) {\n        window.document.activeElement.blur();\n      }\n      event.preventDefault();\n      return;\n    }\n    if (isInputLike(event.target)) return;\n\n    const data = this.actionManager.handleKeyDown(event, elements, this.state);\n    this.syncActionResult(data);\n\n    if (data.elements !== undefined && data.appState !== undefined) {\n      return;\n    }\n\n    if (isArrowKey(event.key)) {\n      const step = event.shiftKey\n        ? ELEMENT_SHIFT_TRANSLATE_AMOUNT\n        : ELEMENT_TRANSLATE_AMOUNT;\n      elements = elements.map(el => {\n        if (el.isSelected) {\n          const element = { ...el };\n          if (event.key === KEYS.ARROW_LEFT) element.x -= step;\n          else if (event.key === KEYS.ARROW_RIGHT) element.x += step;\n          else if (event.key === KEYS.ARROW_UP) element.y -= step;\n          else if (event.key === KEYS.ARROW_DOWN) element.y += step;\n          return element;\n        }\n        return el;\n      });\n      this.forceUpdate();\n      event.preventDefault();\n    } else if (shapesShortcutKeys.includes(event.key.toLowerCase())) {\n      this.setState({ elementType: findShapeByKey(event.key) });\n    } else if (event[META_KEY] && event.code === \"KeyZ\") {\n      if (event.shiftKey) {\n        // Redo action\n        const data = history.redoOnce(elements);\n        if (data !== null) {\n          elements = data;\n        }\n      } else {\n        // undo action\n        const data = history.undoOnce(elements);\n        if (data !== null) {\n          elements = data;\n        }\n      }\n      this.forceUpdate();\n      event.preventDefault();\n    }\n  };\n\n  private removeWheelEventListener: (() => void) | undefined;\n\n  private copyToClipboard = () => {\n    if (navigator.clipboard) {\n      const text = JSON.stringify(\n        elements.filter(element => element.isSelected)\n      );\n      navigator.clipboard.writeText(text);\n    }\n  };\n\n  private pasteFromClipboard = () => {\n    if (navigator.clipboard) {\n      navigator.clipboard\n        .readText()\n        .then(text => this.addElementsFromPaste(text));\n    }\n  };\n\n  public render() {\n    const canvasWidth = window.innerWidth - CANVAS_WINDOW_OFFSET_LEFT;\n    const canvasHeight = window.innerHeight - CANVAS_WINDOW_OFFSET_TOP;\n\n    return (\n      <div\n        className=\"container\"\n        onCut={e => {\n          e.clipboardData.setData(\n            \"text/plain\",\n            JSON.stringify(elements.filter(element => element.isSelected))\n          );\n          elements = deleteSelectedElements(elements);\n          this.forceUpdate();\n          e.preventDefault();\n        }}\n        onCopy={e => {\n          e.clipboardData.setData(\n            \"text/plain\",\n            JSON.stringify(elements.filter(element => element.isSelected))\n          );\n          e.preventDefault();\n        }}\n        onPaste={e => {\n          const paste = e.clipboardData.getData(\"text\");\n          this.addElementsFromPaste(paste);\n          e.preventDefault();\n        }}\n      >\n        <SidePanel\n          actionManager={this.actionManager}\n          syncActionResult={this.syncActionResult}\n          appState={{ ...this.state }}\n          elements={elements}\n          onToolChange={value => {\n            this.setState({ elementType: value });\n            elements = clearSelection(elements);\n            document.documentElement.style.cursor =\n              value === \"text\" ? \"text\" : \"crosshair\";\n            this.forceUpdate();\n          }}\n          canvas={this.canvas!}\n        />\n        <canvas\n          id=\"canvas\"\n          style={{\n            width: canvasWidth,\n            height: canvasHeight\n          }}\n          width={canvasWidth * window.devicePixelRatio}\n          height={canvasHeight * window.devicePixelRatio}\n          ref={canvas => {\n            if (this.canvas === null) {\n              this.canvas = canvas;\n              this.rc = rough.canvas(this.canvas!);\n            }\n            if (this.removeWheelEventListener) {\n              this.removeWheelEventListener();\n              this.removeWheelEventListener = undefined;\n            }\n            if (canvas) {\n              canvas.addEventListener(\"wheel\", this.handleWheel, {\n                passive: false\n              });\n              this.removeWheelEventListener = () =>\n                canvas.removeEventListener(\"wheel\", this.handleWheel);\n\n              // Whenever React sets the width/height of the canvas element,\n              // the context loses the scale transform. We need to re-apply it\n              if (\n                canvasWidth !== lastCanvasWidth ||\n                canvasHeight !== lastCanvasHeight\n              ) {\n                lastCanvasWidth = canvasWidth;\n                lastCanvasHeight = canvasHeight;\n                canvas\n                  .getContext(\"2d\")!\n                  .scale(window.devicePixelRatio, window.devicePixelRatio);\n              }\n            }\n          }}\n          onContextMenu={e => {\n            e.preventDefault();\n\n            const { x, y } = viewportCoordsToSceneCoords(e, this.state);\n\n            const element = getElementAtPosition(elements, x, y);\n            if (!element) {\n              ContextMenu.push({\n                options: [\n                  navigator.clipboard && {\n                    label: \"Paste\",\n                    action: () => this.pasteFromClipboard()\n                  }\n                ],\n                top: e.clientY,\n                left: e.clientX\n              });\n              return;\n            }\n\n            if (!element.isSelected) {\n              elements = clearSelection(elements);\n              element.isSelected = true;\n              this.forceUpdate();\n            }\n\n            ContextMenu.push({\n              options: [\n                navigator.clipboard && {\n                  label: \"Copy\",\n                  action: this.copyToClipboard\n                },\n                navigator.clipboard && {\n                  label: \"Paste\",\n                  action: () => this.pasteFromClipboard()\n                },\n                ...this.actionManager.getContextMenuItems(\n                  elements,\n                  this.state,\n                  this.syncActionResult\n                )\n              ],\n              top: e.clientY,\n              left: e.clientX\n            });\n          }}\n          onMouseDown={e => {\n            if (lastMouseUp !== null) {\n              // Unfortunately, sometimes we don't get a mouseup after a mousedown,\n              // this can happen when a contextual menu or alert is triggered. In order to avoid\n              // being in a weird state, we clean up on the next mousedown\n              lastMouseUp(e);\n            }\n            // only handle left mouse button\n            if (e.button !== 0) return;\n            // fixes mousemove causing selection of UI texts #32\n            e.preventDefault();\n            // Preventing the event above disables default behavior\n            //  of defocusing potentially focused input, which is what we want\n            //  when clicking inside the canvas.\n            if (isInputLike(document.activeElement)) {\n              document.activeElement.blur();\n            }\n\n            // Handle scrollbars dragging\n            const {\n              isOverHorizontalScrollBar,\n              isOverVerticalScrollBar\n            } = isOverScrollBars(\n              elements,\n              e.clientX - CANVAS_WINDOW_OFFSET_LEFT,\n              e.clientY - CANVAS_WINDOW_OFFSET_TOP,\n              canvasWidth,\n              canvasHeight,\n              this.state.scrollX,\n              this.state.scrollY\n            );\n\n            const { x, y } = viewportCoordsToSceneCoords(e, this.state);\n\n            const element = newElement(\n              this.state.elementType,\n              x,\n              y,\n              this.state.currentItemStrokeColor,\n              this.state.currentItemBackgroundColor,\n              \"hachure\",\n              1,\n              1,\n              100\n            );\n            type ResizeTestType = ReturnType<typeof resizeTest>;\n            let resizeHandle: ResizeTestType = false;\n            let isResizingElements = false;\n            let draggingOccured = false;\n            let hitElement: ExcalidrawElement | null = null;\n            let elementIsAddedToSelection = false;\n            if (this.state.elementType === \"selection\") {\n              const resizeElement = getElementWithResizeHandler(\n                elements,\n                { x, y },\n                this.state\n              );\n\n              this.setState({\n                resizingElement: resizeElement ? resizeElement.element : null\n              });\n\n              if (resizeElement) {\n                resizeHandle = resizeElement.resizeHandle;\n                document.documentElement.style.cursor = `${resizeHandle}-resize`;\n                isResizingElements = true;\n              } else {\n                const selected = getElementAtPosition(\n                  elements.filter(el => el.isSelected),\n                  x,\n                  y\n                );\n                // clear selection if shift is not clicked\n                if (!selected && !e.shiftKey) {\n                  elements = clearSelection(elements);\n                }\n                hitElement = getElementAtPosition(elements, x, y);\n\n                // If we click on something\n                if (hitElement) {\n                  // deselect if item is selected\n                  // if shift is not clicked, this will always return true\n                  // otherwise, it will trigger selection based on current\n                  // state of the box\n                  if (!hitElement.isSelected) {\n                    hitElement.isSelected = true;\n                    elementIsAddedToSelection = true;\n                  }\n\n                  // No matter what, we select it\n                  // We duplicate the selected element if alt is pressed on Mouse down\n                  if (e.altKey) {\n                    elements = [\n                      ...elements,\n                      ...elements.reduce((duplicates, element) => {\n                        if (element.isSelected) {\n                          duplicates = duplicates.concat(\n                            duplicateElement(element)\n                          );\n                          element.isSelected = false;\n                        }\n                        return duplicates;\n                      }, [] as typeof elements)\n                    ];\n                  }\n                }\n              }\n            } else {\n              elements = clearSelection(elements);\n            }\n\n            if (isTextElement(element)) {\n              let textX = e.clientX;\n              let textY = e.clientY;\n              if (!e.altKey) {\n                const snappedToCenterPosition = this.getTextWysiwygSnappedToCenterPosition(\n                  x,\n                  y\n                );\n                if (snappedToCenterPosition) {\n                  element.x = snappedToCenterPosition.elementCenterX;\n                  element.y = snappedToCenterPosition.elementCenterY;\n                  textX = snappedToCenterPosition.wysiwygX;\n                  textY = snappedToCenterPosition.wysiwygY;\n                }\n              }\n\n              textWysiwyg({\n                initText: \"\",\n                x: textX,\n                y: textY,\n                strokeColor: this.state.currentItemStrokeColor,\n                font: this.state.currentItemFont,\n                onSubmit: text => {\n                  addTextElement(element, text, this.state.currentItemFont);\n                  elements = [...elements, { ...element, isSelected: true }];\n                  this.setState({\n                    draggingElement: null,\n                    elementType: \"selection\"\n                  });\n                }\n              });\n              return;\n            }\n\n            if (this.state.elementType === \"text\") {\n              elements = [...elements, { ...element, isSelected: true }];\n              this.setState({\n                draggingElement: null,\n                elementType: \"selection\"\n              });\n            } else {\n              elements = [...elements, element];\n              this.setState({ draggingElement: element });\n            }\n\n            let lastX = x;\n            let lastY = y;\n\n            if (isOverHorizontalScrollBar || isOverVerticalScrollBar) {\n              lastX = e.clientX - CANVAS_WINDOW_OFFSET_LEFT;\n              lastY = e.clientY - CANVAS_WINDOW_OFFSET_TOP;\n            }\n\n            const onMouseMove = (e: MouseEvent) => {\n              const target = e.target;\n              if (!(target instanceof HTMLElement)) {\n                return;\n              }\n\n              if (isOverHorizontalScrollBar) {\n                const x = e.clientX - CANVAS_WINDOW_OFFSET_LEFT;\n                const dx = x - lastX;\n                this.setState(state => ({ scrollX: state.scrollX - dx }));\n                lastX = x;\n                return;\n              }\n\n              if (isOverVerticalScrollBar) {\n                const y = e.clientY - CANVAS_WINDOW_OFFSET_TOP;\n                const dy = y - lastY;\n                this.setState(state => ({ scrollY: state.scrollY - dy }));\n                lastY = y;\n                return;\n              }\n\n              if (isResizingElements && this.state.resizingElement) {\n                const el = this.state.resizingElement;\n                const selectedElements = elements.filter(el => el.isSelected);\n                if (selectedElements.length === 1) {\n                  const { x, y } = viewportCoordsToSceneCoords(e, this.state);\n\n                  selectedElements.forEach(element => {\n                    switch (resizeHandle) {\n                      case \"nw\":\n                        element.width += element.x - lastX;\n                        element.x = lastX;\n                        if (e.shiftKey) {\n                          element.y += element.height - element.width;\n                          element.height = element.width;\n                        } else {\n                          element.height += element.y - lastY;\n                          element.y = lastY;\n                        }\n                        break;\n                      case \"ne\":\n                        element.width = lastX - element.x;\n                        if (e.shiftKey) {\n                          element.y += element.height - element.width;\n                          element.height = element.width;\n                        } else {\n                          element.height += element.y - lastY;\n                          element.y = lastY;\n                        }\n                        break;\n                      case \"sw\":\n                        element.width += element.x - lastX;\n                        element.x = lastX;\n                        if (e.shiftKey) {\n                          element.height = element.width;\n                        } else {\n                          element.height = lastY - element.y;\n                        }\n                        break;\n                      case \"se\":\n                        element.width += x - lastX;\n                        if (e.shiftKey) {\n                          element.height = element.width;\n                        } else {\n                          element.height += y - lastY;\n                        }\n                        break;\n                      case \"n\":\n                        element.height += element.y - lastY;\n                        element.y = lastY;\n                        break;\n                      case \"w\":\n                        element.width += element.x - lastX;\n                        element.x = lastX;\n                        break;\n                      case \"s\":\n                        element.height = lastY - element.y;\n                        break;\n                      case \"e\":\n                        element.width = lastX - element.x;\n                        break;\n                    }\n\n                    el.x = element.x;\n                    el.y = element.y;\n                  });\n                  lastX = x;\n                  lastY = y;\n                  // We don't want to save history when resizing an element\n                  history.skipRecording();\n                  this.forceUpdate();\n                  return;\n                }\n              }\n\n              if (hitElement?.isSelected) {\n                // Marking that click was used for dragging to check\n                // if elements should be deselected on mouseup\n                draggingOccured = true;\n                const selectedElements = elements.filter(el => el.isSelected);\n                if (selectedElements.length) {\n                  const { x, y } = viewportCoordsToSceneCoords(e, this.state);\n\n                  selectedElements.forEach(element => {\n                    element.x += x - lastX;\n                    element.y += y - lastY;\n                  });\n                  lastX = x;\n                  lastY = y;\n                  // We don't want to save history when dragging an element to initially size it\n                  history.skipRecording();\n                  this.forceUpdate();\n                  return;\n                }\n              }\n\n              // It is very important to read this.state within each move event,\n              // otherwise we would read a stale one!\n              const draggingElement = this.state.draggingElement;\n              if (!draggingElement) return;\n              let width =\n                e.clientX -\n                CANVAS_WINDOW_OFFSET_LEFT -\n                draggingElement.x -\n                this.state.scrollX;\n              let height =\n                e.clientY -\n                CANVAS_WINDOW_OFFSET_TOP -\n                draggingElement.y -\n                this.state.scrollY;\n              draggingElement.width = width;\n              // Make a perfect square or circle when shift is enabled\n              draggingElement.height = e.shiftKey\n                ? Math.abs(width) * Math.sign(height)\n                : height;\n\n              if (this.state.elementType === \"selection\") {\n                elements = setSelection(elements, draggingElement);\n              }\n              // We don't want to save history when moving an element\n              history.skipRecording();\n              this.forceUpdate();\n            };\n\n            const onMouseUp = (e: MouseEvent) => {\n              const { draggingElement, elementType } = this.state;\n\n              lastMouseUp = null;\n              window.removeEventListener(\"mousemove\", onMouseMove);\n              window.removeEventListener(\"mouseup\", onMouseUp);\n\n              resetCursor();\n\n              // If click occured on already selected element\n              // it is needed to remove selection from other elements\n              // or if SHIFT or META key pressed remove selection\n              // from hitted element\n              //\n              // If click occured and elements were dragged or some element\n              // was added to selection (on mousedown phase) we need to keep\n              // selection unchanged\n              if (\n                hitElement &&\n                !draggingOccured &&\n                !elementIsAddedToSelection\n              ) {\n                if (e.shiftKey) {\n                  hitElement.isSelected = false;\n                } else {\n                  elements = clearSelection(elements);\n                  hitElement.isSelected = true;\n                }\n              }\n\n              if (draggingElement === null) {\n                // if no element is clicked, clear the selection and redraw\n                elements = clearSelection(elements);\n                this.forceUpdate();\n                return;\n              }\n\n              if (elementType === \"selection\") {\n                elements = elements.slice(0, -1);\n              } else {\n                draggingElement.isSelected = true;\n              }\n\n              this.setState({\n                draggingElement: null,\n                elementType: \"selection\"\n              });\n\n              history.resumeRecording();\n              this.forceUpdate();\n            };\n\n            lastMouseUp = onMouseUp;\n\n            window.addEventListener(\"mousemove\", onMouseMove);\n            window.addEventListener(\"mouseup\", onMouseUp);\n\n            // We don't want to save history on mouseDown, only on mouseUp when it's fully configured\n            history.skipRecording();\n            this.forceUpdate();\n          }}\n          onDoubleClick={e => {\n            const { x, y } = viewportCoordsToSceneCoords(e, this.state);\n\n            const elementAtPosition = getElementAtPosition(elements, x, y);\n\n            const element = newElement(\n              \"text\",\n              x,\n              y,\n              this.state.currentItemStrokeColor,\n              this.state.currentItemBackgroundColor,\n              \"hachure\",\n              1,\n              1,\n              100\n            ) as ExcalidrawTextElement;\n\n            let initText = \"\";\n            let textX = e.clientX;\n            let textY = e.clientY;\n\n            if (elementAtPosition && isTextElement(elementAtPosition)) {\n              elements = elements.filter(\n                element => element.id !== elementAtPosition.id\n              );\n              this.forceUpdate();\n\n              Object.assign(element, elementAtPosition);\n              // x and y will change after calling addTextElement function\n              element.x = elementAtPosition.x + elementAtPosition.width / 2;\n              element.y = elementAtPosition.y + elementAtPosition.height / 2;\n              initText = elementAtPosition.text;\n              textX =\n                this.state.scrollX +\n                elementAtPosition.x +\n                CANVAS_WINDOW_OFFSET_LEFT +\n                elementAtPosition.width / 2;\n              textY =\n                this.state.scrollY +\n                elementAtPosition.y +\n                CANVAS_WINDOW_OFFSET_TOP +\n                elementAtPosition.height / 2;\n            } else if (!e.altKey) {\n              const snappedToCenterPosition = this.getTextWysiwygSnappedToCenterPosition(\n                x,\n                y\n              );\n\n              if (snappedToCenterPosition) {\n                element.x = snappedToCenterPosition.elementCenterX;\n                element.y = snappedToCenterPosition.elementCenterY;\n                textX = snappedToCenterPosition.wysiwygX;\n                textY = snappedToCenterPosition.wysiwygY;\n              }\n            }\n\n            textWysiwyg({\n              initText,\n              x: textX,\n              y: textY,\n              strokeColor: element.strokeColor,\n              font: element.font || this.state.currentItemFont,\n              onSubmit: text => {\n                addTextElement(\n                  element,\n                  text,\n                  element.font || this.state.currentItemFont\n                );\n                elements = [...elements, { ...element, isSelected: true }];\n                this.setState({\n                  draggingElement: null,\n                  elementType: \"selection\"\n                });\n              }\n            });\n          }}\n          onMouseMove={e => {\n            const hasDeselectedButton = Boolean(e.buttons);\n            if (hasDeselectedButton || this.state.elementType !== \"selection\") {\n              return;\n            }\n            const { x, y } = viewportCoordsToSceneCoords(e, this.state);\n            const resizeElement = getElementWithResizeHandler(\n              elements,\n              { x, y },\n              this.state\n            );\n            if (resizeElement && resizeElement.resizeHandle) {\n              document.documentElement.style.cursor = `${resizeElement.resizeHandle}-resize`;\n              return;\n            }\n            const hitElement = getElementAtPosition(elements, x, y);\n            if (hitElement) {\n              const resizeHandle = resizeTest(hitElement, x, y, {\n                scrollX: this.state.scrollX,\n                scrollY: this.state.scrollY\n              });\n              document.documentElement.style.cursor = resizeHandle\n                ? `${resizeHandle}-resize`\n                : `move`;\n            } else {\n              document.documentElement.style.cursor = ``;\n            }\n          }}\n        />\n      </div>\n    );\n  }\n\n  private handleWheel = (e: WheelEvent) => {\n    e.preventDefault();\n    const { deltaX, deltaY } = e;\n    this.setState(state => ({\n      scrollX: state.scrollX - deltaX,\n      scrollY: state.scrollY - deltaY\n    }));\n  };\n\n  private addElementsFromPaste = (paste: string) => {\n    let parsedElements;\n    try {\n      parsedElements = JSON.parse(paste);\n    } catch (e) {}\n    if (\n      Array.isArray(parsedElements) &&\n      parsedElements.length > 0 &&\n      parsedElements[0].type // need to implement a better check here...\n    ) {\n      elements = clearSelection(elements);\n\n      let subCanvasX1 = Infinity;\n      let subCanvasX2 = 0;\n      let subCanvasY1 = Infinity;\n      let subCanvasY2 = 0;\n\n      const minX = Math.min(...parsedElements.map(element => element.x));\n      const minY = Math.min(...parsedElements.map(element => element.y));\n\n      const distance = (x: number, y: number) => {\n        return Math.abs(x > y ? x - y : y - x);\n      };\n\n      parsedElements.forEach(parsedElement => {\n        const [x1, y1, x2, y2] = getElementAbsoluteCoords(parsedElement);\n        subCanvasX1 = Math.min(subCanvasX1, x1);\n        subCanvasY1 = Math.min(subCanvasY1, y1);\n        subCanvasX2 = Math.max(subCanvasX2, x2);\n        subCanvasY2 = Math.max(subCanvasY2, y2);\n      });\n\n      const elementsCenterX = distance(subCanvasX1, subCanvasX2) / 2;\n      const elementsCenterY = distance(subCanvasY1, subCanvasY2) / 2;\n\n      const dx =\n        this.state.cursorX -\n        this.state.scrollX -\n        CANVAS_WINDOW_OFFSET_LEFT -\n        elementsCenterX;\n      const dy =\n        this.state.cursorY -\n        this.state.scrollY -\n        CANVAS_WINDOW_OFFSET_TOP -\n        elementsCenterY;\n\n      elements = [\n        ...elements,\n        ...parsedElements.map(parsedElement => {\n          const duplicate = duplicateElement(parsedElement);\n          duplicate.x += dx - minX;\n          duplicate.y += dy - minY;\n          return duplicate;\n        })\n      ];\n      this.forceUpdate();\n    }\n  };\n\n  private getTextWysiwygSnappedToCenterPosition(x: number, y: number) {\n    const elementClickedInside = getElementContainingPosition(elements, x, y);\n    if (elementClickedInside) {\n      const elementCenterX =\n        elementClickedInside.x + elementClickedInside.width / 2;\n      const elementCenterY =\n        elementClickedInside.y + elementClickedInside.height / 2;\n      const distanceToCenter = Math.hypot(\n        x - elementCenterX,\n        y - elementCenterY\n      );\n      const isSnappedToCenter =\n        distanceToCenter < TEXT_TO_CENTER_SNAP_THRESHOLD;\n      if (isSnappedToCenter) {\n        const wysiwygX =\n          this.state.scrollX +\n          elementClickedInside.x +\n          CANVAS_WINDOW_OFFSET_LEFT +\n          elementClickedInside.width / 2;\n        const wysiwygY =\n          this.state.scrollY +\n          elementClickedInside.y +\n          CANVAS_WINDOW_OFFSET_TOP +\n          elementClickedInside.height / 2;\n        return { wysiwygX, wysiwygY, elementCenterX, elementCenterY };\n      }\n    }\n  }\n\n  componentDidUpdate() {\n    renderScene(elements, this.rc!, this.canvas!, {\n      scrollX: this.state.scrollX,\n      scrollY: this.state.scrollY,\n      viewBackgroundColor: this.state.viewBackgroundColor\n    });\n    saveToLocalStorage(elements, this.state);\n    if (history.isRecording()) {\n      history.pushEntry(history.generateCurrentEntry(elements));\n      history.clearRedoStack();\n    }\n  }\n}\n\nconst rootElement = document.getElementById(\"root\");\nReactDOM.render(<App />, rootElement);\n"],"sourceRoot":""}